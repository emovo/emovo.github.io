<!DOCTYPE html>
<html lang='en' dir='ltr'>
  <title>War Map</title>
  <meta charset='UTF-8'> 
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
  <meta name='Set-Cookie' content='HttpOnly;Secure;SameSite=None'/>
  <script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
  <script src='https://code.jquery.com/jquery-3.2.1.min.js'></script>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js'></script>
  <link rel='stylesheet' href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css'/>
  <!--<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">-->
  <link href="https://fonts.googleapis.com/css2?family=Rye&display=swap" rel="stylesheet">
  <script src='civilwarbattlesgeo.js'></script>
  <script src='civilwarbattles.js'></script>
  <script src='us_state_bounds.js'></script>
  <script src='world_bounds.js'></script>
  <script src='civilwar_elections.js'></script>
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Raleway'/>
  <link rel='stylesheet' type='text/css' href='//fonts.googleapis.com/css?family=Special+Elite'/>
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css'/>
  <style>
    body,h1,h2,h3,h4,h5,h6 {font-family: 'Rye', cursive;}
    /*font-family: 'Raleway', Arial, Helvetica, sans-serif*/
    body{ 
      margin: 0; 
      padding: 0; 
      background-color: #d9d1ba; 
      /*color: #ada16e; #f9b043;*/
      color: black;
    }
    /* http://jsfiddle.net/hashem/n3rspnbh/
       http://jsfiddle.net/CH9K8/
    */
    /*.overall{
      width: 99.8%;
      height: 500px;
      overflow: hidden; 
    }
    .general_info{
      width: 70%;
      height: 70%;
      display: none;
      border: 1px solid antiquewhite;
    }*/
    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      height: 7%;
      display: flex;
      overflow: hidden;
      background-color: #333;
    }

    li {
      float: left;
    }

    li a {
      display: block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
    }

    li a:hover:not(.active) {
      background-color: #111;
    }

    .active {
      background-color: #4CAF50;
    }
    .footer {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      text-align: center;
    }


    .map{ 
      position: absolute; 
      width: 100%;
      height: 87%; 
      z-index: -1;
    }
    .button{
      font-family: 'Rye', cursive;
      border: 2px solid #ceb793;
      border-radius: 15%;
      background-color: antiquewhite;
      color: black;
    }
    .timeline_buttons{
      margin-left: auto;
      margin-right: auto;
      width: 50%;
      display: flex;
    }
    .timeline_buttons.space_out{
      justify-content: space-around;
    }
    .president_image{
      border-radius: 50%;
      color: antiquewhite;
    }

    /* The Modal (background) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    /* Modal Content/Box */
    .modal-content {
      background-color: antiquewhite;
      margin: 15% auto; /* 15% from the top and centered */
      padding: 20px;
      z-index: 2;
      border: 1px solid #888;
      width: 80%; /* Could be more or less, depending on screen size */
      overflow: auto; /* Enable scroll if needed */
    }
    .close {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    #search_box{
      float: left;
      background: antiquewhite;
      z-index: 2;
    }
    .box{
      z-index: 1;
      float: right;
      width: 25%;
      background: antiquewhite;
    }
    .box-content {
      background-color: antiquewhite;
      margin: 15% auto; 
      padding: 20px;
      z-index: 2;
      overflow: auto; 
    }
    .loader {
      border: 16px solid antiquewhite;
      border-radius: 50%;
      border-top: 8px solid #000000;
      width: 120px;
      height: 120px;
      -webkit-animation: spin 2s linear infinite; 
      animation: spin 2s linear infinite;
    }
    @-webkit-keyframes spin {
      0% { -webkit-transform: rotate(0deg); }
      100% { -webkit-transform: rotate(360deg); }
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .autocomplete {
      z-index: 2;
    }
    .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      /*position the autocomplete items to be the same width as the container:*/
      top: 100%;
      left: 0;
      right: 0;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover {
      /*when hovering an item:*/
      background-color: #e9e9e9;
    }
    .autocomplete-active {
      /*when navigating through the items using the arrow keys:*/
      background-color: DodgerBlue !important;
      color: #ffffff;
    }

    #timeline{
      width: 100%;
      z-index: 100;
    }
    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 25px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

    .slider:hover {
      opacity: 1;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 25px;
      height: 25px;
      background: #4CAF50;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 25px;
      height: 25px;
      background: #4CAF50;
      cursor: pointer;
    }
  </style>
  <body>
    <ul>
      <li><a href="civilwar_about.html">About</a></li>
      <li><a href="#" onclick="showSettings()">Map Settings</a></li>
      <li><a href="#" onclick="showYearReport()">Year Report</a></li>
      <li><a href="civilwar_troops.html">Troop Statistics</a></li>
      <li><a href="civilwar_morse.html">Morse Code</a></li>
      <!--only appear for 1861 and 1864. Show candidates and adjusted map 
          color over the maps on mapbox and have a marker to differentiate 1860 borders from today
      -->
      <li id="elections"><a href="#" onclick="showElection()">Recent Election!</a></li> 
    </ul>
    <div id='intro_modal' class='modal' style='display:none;'> 
      <div id='intro' class='modal-content'>
        <p id='intro_text'></p>
        <p id='intro_long_text'></p>
        <button id="intro_close" class="button">See battle map</button>
        <br>
        <br>
        <button id="help_open" class="button">Help</button>
      </div>
    </div>
    <div id='help_modal' class='modal' style='display:none;'> 
      <div id='help' class='modal-content'>
        <span id='help_close' class='close' style="float: right;">&times;</span>
        <p>Instructions</p>
        <p>In regards to the map:</p>
        <p>- Click the little map markers to see more information about a specific battle. The map markers have the following significance based on 
          <a href="http://npshistory.com/publications/battlefield/cwsac/report.pdf" style="color: black;">Civil War Sites Advisory Commission</a> classifications:</p>
        <br>
        <img src="images\a_battle.png" src="" alt="class A"></img> - Decisive Engagement (class A)
        <br>
        <img src="images\b_battle.png" src="" alt="class B"></img> - Major Engagement (class B)
        <br>
        <img src="images\c_battle.png" src="" alt="class C"></img> - Formative Engagement (class C)
        <br>
        <img src="images\d_battle.png" src="" alt="class D"></img> - Limited Engagement (class D)
        <br>
        <br>
        <p>- Click highlighted countries to see some information about how they responded to the conflict.</p>
        <p>- Use the "Map Settings" tab to adjust the heatmap visuals for the battles.</p>
        <p>- Use the "War Report" tab to see general conflict statistics related to the year.</p>
        <br>
        <p>In regards to the tabs:</p>
        <p>- Use the "Troop Statistics" tab to see a slideshow infographic-esque visual of certain statistics about the conflict.</p>
        <p>- Use the "Morse Code" tab to see a text to morse code (and vice versa) converter.</p>
      </div>
    </div>
    
    <div id="heatmap_sides" style="float: left; top: 30%; z-index: 3;">
      <!--<select id="heatmap_view">
        <option value="heatmap_general" selected>Heatmap (General)</option>
        <br>
        <option value="heatmap_union">Heatmap (Union Victories)</option>
        <br>
        <option value="heatmap_confed">Heatmap (Confederate Victories)</option>
      </select>-->
      <div id="heatmap_part" style="display: none;">
        <input type="radio" id="heatmap_general" name="heatmap_choice" value="heatmap_general" onclick="chooseHeatmap(this.id)" checked="checked">
        <label for="heatmap_general">Heatmap (General)</label>
        <br>
        <input type="radio" id="heatmap_union" name="heatmap_choice" value="heatmap_union" onclick="chooseHeatmap(this.id)">
        <label for="heatmap_general">Heatmap (Union Victories)</label>
        <br>
        <input type="radio" id="heatmap_confed" name="heatmap_choice" value="heatmap_confed" onclick="chooseHeatmap(this.id)">
        <label for="heatmap_general">Heatmap (Confederate Victories)</label>
      </div>
      <br>
      <button id="slidebar_activate" class="button" onclick="runTimeline()" style="display:none;">Activate Timeline</button>
    </div>
    <!--<div class="autocomplete">
      <input id="search_box" type="text" onkeyup="checkBattle('search_box')" placeholder="Search a battle">
    </div>-->
    <div id='election_modal' class='modal' style='display:none;'> 
      <div id='election' class='modal-content'>
        <p id='election_text'></p>
        <p id='election_long_text'></p>
        <br>
        <button id="election_close" class="button">See Election</button>
      </div>
    </div>
    <div id='candidates_box_hover' class='box' style='display:none; border-radius: 5%; width: 15%;'> 
      <div id='candidates' class='box-content'>
        <p id='state_hover_text'></p>
        <p id='state_hover_long_text'>Click a state to see its election results.</p>
      </div>
    </div>
    <div id='candidates_box' class='box' style='display:none;'> 
      <div id='candidates' class='box-content'>
        <span id='candidates_box_close' class='close' style="float: right;">&times;</span>
        <p id='candidates_text'></p>
        <p id='candidates_long_text'></p>
        <div id="candidates_vote_table"></div>
      </div>
    </div>
    <div id='nations_modal' class='modal' style='display:none;'>
      <div id='nations' class='modal-content'>
        <span id='nations_close' class='close' style="float: right;">&times;</span>
        <p id='nations_text'></p>
        <p id='nations_modal_long_text'></p>
      </div>
    </div>
    <div id='general_info' class='modal' style='display:none;'>
      <div id='info' class='modal-content'>
        <span id='general_info_close' class='close' style="float: right;">&times;</span>
        <p id='battle_title'></p>
        <p id='time_date'></p>
        <p id='location'></p>
        <p id='type'></p>
        <p id='facts'></p>
        <p id='outcome'></p>
        <iframe id='iframe' width='400' height='300' src='#' style='display:none;'></iframe>
        <!--<br>
        <button id='get_relics' class='button' onclick="getRelics()">See Relics</button>-->
        <br>
        <button id='fly_to_next' class='button' onclick="nextBattle()">Go to next battle</button>
      </div>
    </div>
    <div id='settings_modal' class='modal' style='display:none;'> 
      <div id='settings' class='modal-content' style="text-align: center;">
        <span id='settings_close' class='close' style="float: right;">&times;</span>
        <p>Show heatmap for all years all at once or show it on a year by year basis?</p>
        <select id="heatmap_select">
          <option value="heatmap_all">Heatmap for all years</option>
          <option value="heatmap_per_year" selected>Heatmap for each year</option>
        </select>
        <br>
        <br>
        <label for="heatmap_only_choice">Show only heatmap? </label> 
        <input type="checkbox" id="heatmap_only_choice">
        <br>
        <br>
        <button id="apply_settings" class="button" onclick="applySettings()">Apply Settings</button>
      </div>
    </div>
    <div id='report_modal' class='modal' style='display:none;'> 
      <div id='report' class='modal-content' style="text-align: center;">
        <span id='report_close' class='close' style="float: right;">&times;</span>
        <h3>War Report</h3>
        <p id="year_count_text"></p>
        <br>
        <p id="class_comp_text"></p>
        <br>
        <p id="victor_text"></p>
        <br>
        <p id="of_victor_text"></p>
        <br>
        <table id="battles_by_state" cellspacing="1" cellpadding="1" style="margin: 0 auto; display: none;"></table>
      </div>
    </div>
    <div id='relics_modal' class='modal' style='display:none;'>
      <div id='relics' class='modal-content'>
        <span id='relics_close' class='close' style="float: right;">&times;</span>
        <p id="title"></p>
        <div id='loading' class='loader'></div>
        <img id="image" src="" alt="news" width="400" height="400"></img>
        <button id="left" class="w3-button w3-black w3-display-left" onclick="changeNews(-1)">&#10094;</button>
        <button id="right" class="w3-button w3-black w3-display-right" onclick="changeNews(1)">&#10095;</button>
        <button id='get_general_info' class='button' onclick="getGeneralInfo()">General Info</button>
        <button id='fly_to_next' class='button'>Go to next battle</button>
      </div>
    </div>
    <div id='war_map' class='map'></div>
    <div class="footer">
      <!--<div class='timeline_buttons space_out' style='color:antiquewhite;'>
        <h3 id='year_text'></h3>
      </div>-->
      <div id="timeline" style="display: none;">
        <p id="timeline_date">Yo</p>
        <input id="timeline_value" type="range" min="1" max="100" value="5" class="slider">
      </div>
      <ul style='justify-content: space-around;'>
        <!--https://www.battlefields.org/learn/primary-sources/cornerstone-speech-->
        <li><a id='1861' href='javascript:;' onclick='preSetUpPoints(this.id)'>1861</a></li>

        <li><a id='1862' href='javascript:;' onclick='preSetUpPoints(this.id)'>1862</a></li>

        <li><a id='1863' href='javascript:;' onclick='preSetUpPoints(this.id)'>1863</a></li>

        <li><a id='1864' href='javascript:;' onclick='preSetUpPoints(this.id)'>1864</a></li>

        <li><a id='1865' href='javascript:;' onclick='preSetUpPoints(this.id)'>1865</a></li>
      </ul>
    </div>
    <script>
document.getElementById('intro_close').onclick = function() {
  document.getElementById('intro_modal').style.display = 'none';
}
document.getElementById('election_close').onclick = function() {
  document.getElementById('election_modal').style.display = 'none';
}
document.getElementById('general_info_close').onclick = function() {
  document.getElementById('general_info').style.display = 'none';
}
document.getElementById('relics_close').onclick = function() {
  document.getElementById('relics_modal').style.display = 'none';
}
document.getElementById('settings_close').onclick = function() {
  document.getElementById('settings_modal').style.display = 'none';
}
document.getElementById('report_close').onclick = function() {
  document.getElementById('report_modal').style.display = 'none';
}
document.getElementById('candidates_box_close').onclick = function() {
  document.getElementById('candidates_box').style.display = 'none';
  clicked_election_state = false;
}
document.getElementById('nations_close').onclick = function() {
  document.getElementById('nations_modal').style.display = 'none';
  clicked_nation = false;
}
document.getElementById('help_close').onclick = function() {
  document.getElementById('help_modal').style.display = 'none';
}
document.getElementById('help_open').onclick = function() {
  document.getElementById('intro_modal').style.display = 'none';
  document.getElementById('help_modal').style.display = 'block';
}

let current_markers = {};
let maps_url;
let newspapers_url;
let images_url;
let battle_name;
let relics = [];
let year = 1861;
let mouse_list = [];
let election_button = false;
//MAP A HEATMAP OF BATTLES
//https://docs.mapbox.com/help/tutorials/make-a-heatmap-with-mapbox-gl-js/
//multiple sites: battle of hancock, fort henry

//HAVE A UPPER TAB THAT OVERLAYS 4 BUTTONS
//HAVE MORSE CODE TRANSLATOR
//LET USERS ANONYMOUSLY REPORT ANY DATA ISSUES
//HAVE PERCENTAGE OF BATTLES AT WHICH STATE
//26 U.S. states with Virginia (123), Tennessee (38), Missouri (29), and Georgia(28) 384 PRINCIPLE BATTLES

//localStorage.setItem("year", 1861);
mapboxgl.accessToken = 'pk.eyJ1IjoicmVkc2VhbGFicyIsImEiOiJja2MxNHU1d3MwZWJoMm9qcjNubjFycWM0In0.9HokRTHHG2RcNFwrhFHBgA';
let map = new mapboxgl.Map({
  container: 'war_map',
  style: 'mapbox://styles/redsealabs/ckd85s84z082g1imwmyy87qfi',
  center: [0, 0], 
  interactive: true,
  //perhaps have the a button that lets users shift pitch and bearing
  //pitch: 30, // pitch in degrees
  //bearing: -30, // bearing in degrees
  minZoom: 3, 
  maxZoom: 15
});
map.flyTo({
  center: [-98.6264896, 38.2241172],
  essential: true
});
map.on('load', function() {
  constructHeatmap(1861);
  preSetUpPoints('1861');
});
function constructHeatmap(year){
  if(map.getLayer('heatmap_layer')){
    map.removeLayer('heatmap_layer');
  }
  if(map.getSource('battle_points')){
    map.removeSource('battle_points');
  }
  //toggle heatmap: https://docs.mapbox.com/mapbox.js/example/v1.0.0/layers/
  let battle_years = [1861, 1862, 1863, 1864, 1865];
  let feature_array = [];
  let keys = Object.keys(civil_war_battles_geo);
  for(var battle_name in civil_war_battles){
    let battle = civil_war_battles[battle_name];
    let date = battle['date'].split(',');
    if(battle_years.includes(year)){
      if(keys.indexOf(battle_name) > -1 && year === parseInt(date[1])){ 
        let battle_loc = civil_war_battles_geo[battle_name]['lat_lng'];
        let battle_lat = parseFloat(battle_loc.split(",")[0]);
        let battle_lng = parseFloat(battle_loc.split(",")[1]);
        let point = {
          'type': 'Feature',
          'geometry': {
            'type': 'Point',
            'coordinates': [battle_lng, battle_lat]
          }
        }
        feature_array.push(point);
      }
    }else{
      if(keys.indexOf(battle_name) > -1){ 
        let battle_loc = civil_war_battles_geo[battle_name]['lat_lng'];
        let battle_lat = parseFloat(battle_loc.split(",")[0]);
        let battle_lng = parseFloat(battle_loc.split(",")[1]);
        let point = {
          'type': 'Feature',
          'geometry': {
            'type': 'Point',
            'coordinates': [battle_lng, battle_lat]
          }
        }
        feature_array.push(point);
      }
    }
  }
  map.addSource('battle_points', {
    'type': 'geojson',
    'data': {
      'type': 'FeatureCollection',
      'features': feature_array
    }
  });
  
  map.addLayer({
    id: 'heatmap_layer',
    source: 'battle_points',
    type: 'heatmap',
    paint: {
      'heatmap-radius': 40,
      "heatmap-color": 
          [
            'interpolate',
            ['linear'],
            ['heatmap-density'],
            0, 'rgba(240,29,29,0)',
            0.2, 'rgba(212, 175, 55, 1)', 
            0.4, 'rgba(255, 165, 0, 1)', 
            0.7, 'rgba(226, 88, 34, 1)', 
            1.0, 'rgba(178, 34, 34, 1)'
          ],
      "heatmap-weight": {
        "type": "identity", 
        "property": "point_count"
      }
    }
  });
}
function chooseHeatmap(heatmap_val){
  if(heatmap_val === 'heatmap_general')
    constructHeatmap(year);
  if(heatmap_val === 'heatmap_union')
    adjustedHeatmap(year, 'Union');
  if(heatmap_val === 'heatmap_confed')
    adjustedHeatmap(year, 'Confederate');
}
function adjustedHeatmap(year, side){
  if(map.getLayer('heatmap_layer')){
    map.removeLayer('heatmap_layer');
  }
  if(map.getSource('battle_points')){
    map.removeSource('battle_points');
  }
  //toggle heatmap: https://docs.mapbox.com/mapbox.js/example/v1.0.0/layers/
  let battle_years = [1861, 1862, 1863, 1864, 1865];
  let feature_array = [];
  let keys = Object.keys(civil_war_battles_geo);
  for(var battle_name in civil_war_battles){
    let battle = civil_war_battles[battle_name];
    let date = battle['date'].split(',');
    if(battle_years.includes(year)){
      if(keys.indexOf(battle_name) > -1 && year === parseInt(date[1]) && battle['victory'] === side){ 
        let battle_loc = civil_war_battles_geo[battle_name]['lat_lng'];
        let battle_lat = parseFloat(battle_loc.split(",")[1]);
        let battle_lng = parseFloat(battle_loc.split(",")[1]);
        let point = {
          'type': 'Feature',
          'geometry': {
            'type': 'Point',
            'coordinates': [battle_lng, battle_lat]
          }
        }
        feature_array.push(point);
      }
    }else{
      if(keys.indexOf(battle_name) > -1){ 
        let battle_loc = civil_war_battles_geo[battle_name]['lat_lng'];
        let battle_lat = parseFloat(battle_loc.split(",")[0]);
        let battle_lng = parseFloat(battle_loc.split(",")[1]);
        let point = {
          'type': 'Feature',
          'geometry': {
            'type': 'Point',
            'coordinates': [battle_lng, battle_lat]
          }
        }
        feature_array.push(point);
      }
    }
  }
  map.addSource('battle_points', {
    'type': 'geojson',
    'data': {
      'type': 'FeatureCollection',
      'features': feature_array
    }
  });
  map.addLayer({
    id: 'heatmap_layer',
    source: 'battle_points',
    type: 'heatmap',
    paint: {
      'heatmap-radius': 40,
      "heatmap-color": [  
            'interpolate',
            ['linear'],
            ['heatmap-density'],
            0, 'rgba(240,29,29,0)',
            0.2, 'rgba(212, 175, 55, 1)', 
            0.4, 'rgba(255, 165, 0, 1)', 
            0.7, 'rgba(226, 88, 34, 1)', 
            1.0, 'rgba(178, 34, 34, 1)'
          ],
      "heatmap-weight": {
        "type": "identity", 
        "property": "point_count"
      }
    }
  });
}
let slideIndex = 0;
function changeNews(n) {
  slideIndex += n;
  showNews(relics);
}

function clearElection(){
  document.getElementById('candidates_box').style.display = 'none';
  document.getElementById('candidates_box_hover').style.display = 'none';
  if(election_button){
    for(let i = 0; i < mouse_list.length; i++){
      map.removeLayer(mouse_list[i]);
      map.removeSource(mouse_list[i]);
    }
  }
  mouse_list = [];
}

function constructHeatmap1864(){
  //toggle heatmap: https://docs.mapbox.com/mapbox.js/example/v1.0.0/layers/
  let battle_years = [1861, 1862, 1863, 1864, 1865];
  let feature_array = [];
  let keys = Object.keys(civil_war_battles_geo);
  let union_victs = 0;
  let confed_victs = 0;
  let ties = 0;
  for(var battle_name in civil_war_battles){
    let battle = civil_war_battles[battle_name];
    let date = battle['date'].split(',');
    let nearElection = false;
    let nearMonths = ['June', 'July', 'August', 'September', 'October', 'November']; //Nat. Union convention occurred in June
    for(let i = 0; i < nearMonths.length; i++){
      if(battle['date'].includes(nearMonths[i])){
        nearElection = true;
      }
    }
    if(keys.indexOf(battle_name) > -1 && 1864 === parseInt(date[1]) && nearElection){ 
      if(battle['victory'] === 'Inconclusive'){
        ties++;
      }else if(battle['victory'] === 'Union'){
        union_victs++;
      }else if(battle['victory'] === 'Confederate'){
        confed_victs++;
      }
      let battle_loc = civil_war_battles_geo[battle_name]['lat_lng'];
      let battle_lat = parseFloat(battle_loc.split(",")[0]);
      let battle_lng = parseFloat(battle_loc.split(",")[1]);
      let point = {
        'type': 'Feature',
        'geometry': {
          'type': 'Point',
          'coordinates': [battle_lng, battle_lat]
        }
      }
      feature_array.push(point);
    }
  }
  map.addSource('battle_points', {
    'type': 'geojson',
    'data': {
      'type': 'FeatureCollection',
      'features': feature_array
    }
  });
  
  map.addLayer({
    id: 'heatmap_layer',
    source: 'battle_points',
    type: 'heatmap',
    paint: {
      'heatmap-radius': 40,
      "heatmap-color": 
          [  
            'interpolate',
            ['linear'],
            ['heatmap-density'],
            0, 'rgba(240,29,29,0)',
            0.2, 'rgba(212, 175, 55, 1)', 
            0.4, 'rgba(255, 165, 0, 1)', 
            0.7, 'rgba(226, 88, 34, 1)', 
            1.0, 'rgba(178, 34, 34, 1)'
          ],
      "heatmap-weight": {
        "type": "identity", 
        "property": "point_count"
      }
    }
  });
  return {'union_victs': union_victs, 'confed_victs': confed_victs, 'ties': ties};
}

let state_hovered = "";
let clicked_election_state = false;
function showElection(){
  document.getElementById('heatmap_sides').style.display = 'none';
  clicked_election_state = false;
  //document.getElementById('search_box').style.display = 'none';
  document.getElementById('candidates_box_hover').style.display = 'block';
  removeWorldData();
  deleteMarkers();
  clearElection();
  if(map.getLayer('heatmap_layer')){
    map.removeLayer('heatmap_layer');
  }
  if(map.getSource('battle_points')){
    map.removeSource('battle_points');
  }
  if(parseInt(year) === 1861){
    document.getElementById('election_text').innerText = 'Election of 1860';
    document.getElementById('election_long_text').innerHTML = 'With the issue of slavery and the associated states rights becoming an increasingly unavoidable issue to address, the election became extremely tumultuous, as certain states began threatening to secede from the Union if the election results weren\'t in their favor. ' 
      + ' The Republicans were a relatively new party, selecting Abraham Lincoln - Hannibal Hamlin as their ticket. The party was anti-slavery, making them firmly supported in the North. '
      + ' The primary party opposing them was the Southern Democrats, a newly formed group that emerged from the splitting of the Democrat Party. Their platform was pro-slavery and they selected John Breckinbridge - Joseph Lane as their ticket.'
      + ' There was also the Northern Democrats, the other half of the original Democrat Party, who nominated Stephen Douglas - Herschel Johnson as their ticket. There platform was not pro-slavery, and were somewhat more moderate on the slavery issue, with Douglas being the one who devised the concept of popular sovereignty (let the states decide whether to be a slave or free state) for new states entering the Union. '
      + ' Another contender was the Constitutional Party, which nominated John Bell - Edward Everett as their ticket. They were against the idea of secession, as they saw it as an affront to the Constitution, and did not have a stance on slavery. Much of their votes came from people in the South who weren\'t as fervent in the idea of secession ';
      + ' (see <a href="https://en.wikipedia.org/wiki/Southern_Unionist" style="color: black;">Southern Unionist</a>). '
      + ' In some of the pro-Lincoln states, non-Republican candidates pooled their votes together into a fusion ticket, though it was unsuccessful in preventing Lincoln from getting the electoral votes from those states. '
      + '<br><br>Click on the color-coded states to see the election results.';
    document.getElementById('election_modal').style.display = 'block';
    showElection1860();
  }
  if(parseInt(year) === 1864){
    let war_state = constructHeatmap1864();
    document.getElementById('election_text').innerText = 'Election of 1864';
    document.getElementById('election_long_text').innerHTML = ' With the Civil War still raging on, the Union were to conduct a presidential election under unprecedented circumstances. For this election, Abraham Lincoln, the incumbent and head of the National Union Party (a re-naming of the Republican Party), and chose his new VP to be Andrew Johnson of the War Democrats. '
      + ' Opposing them was former Union George McClellan with George Pendleton as the VP pick. The main question at the time was to decide whether to pursue peace with the Confederacy or continue the war, '
      + ' with the National Union platform wanting to continue, and the Democrat platform being split among the Peace and War Democrat factions. '
      + ' It\'s important to remember that at the time for much of the Civil War, the Union becoming a victor in the conflict was not necessarily a certainty, especially given the many battle victories the Confederates got. '
      + '<br><br>Click on the states to see their voting records this election. A heatmap of the battles that occurred around the election time period is also displayed as well, as its important to remember the nation was still divided.';
    document.getElementById('election_modal').style.display = 'block';
    showElection1864();
  }
}

let state_choices_1860 = {};
function showElection1860(){
  let state_names_1860 = Object.keys(election_data_1860);
  let feature_states = [];
  for(let i = 0; i < stateBounds.features.length; i++){
    feature_states.push(stateBounds.features[i].properties.name);
  }
  election_button = true; 
  for(let i = 0; i < feature_states.length; i++){
    let name_index = state_names.indexOf(feature_states[i]);
    if(name_index > -1){
      mouse_list.push(feature_states[i]);
      let feature  = {"type":"FeatureCollection","features":[stateBounds.features[i]]};
      map.addSource(feature_states[i], {
        type: 'geojson',
        data: feature
      });
      let color = '#edc9af';  //color for if it was still a territory
      let name_index_1860 = state_names_1860.indexOf(feature_states[i]);
      if(name_index_1860 > -1){
        let state_1860 = election_data_1860[feature_states[i]];
        let state_1860_counts = [];
        if(!isNaN(parseInt(state_1860.r_e)) && parseInt(state_1860.r_e) !== undefined){
          state_1860_counts['Republican'] = parseInt(state_1860.r_e);
        }
        if(!isNaN(parseInt(state_1860.nd_e)) && parseInt(state_1860.nd_e) !== undefined){
          state_1860_counts['Northern Democrat'] = parseInt(state_1860.nd_e);
        }
        if(!isNaN(parseInt(state_1860.sd_e)) && parseInt(state_1860.sd_e) !== undefined){
          state_1860_counts['Southern Democrat'] = parseInt(state_1860.sd_e);
        }
        if(!isNaN(parseInt(state_1860.cu_e)) && parseInt(state_1860.cu_e) !== undefined){
          state_1860_counts['Constitutional Union'] = parseInt(state_1860.cu_e);
        }
        if(!isNaN(parseInt(state_1860.f_e)) && parseInt(state_1860.f_e) !== undefined){
          state_1860_counts['Fusion'] = parseInt(state_1860.f_e);
        }
        let counts = Object.keys(state_1860_counts).map(function(key) {
          return [key, state_1860_counts[key]];
        });
        counts.sort(function(first, second) {
          return second[1] - first[1];
        });
        if(counts.length > 0){
          //Constitutional Union: Orange (#ffa500), republican, northern democrat(#40e0d0), southern democrat (#6699CC), no fusion party wins 
          if(counts[0][0] === 'Republican'){
            state_choices_1860[feature_states[i]] = 'Abraham Lincoln (Republican Party)';
            color = '#de1738';
          }
          if(counts[0][0] === 'Northern Democrat'){ 
            state_choices_1860[feature_states[i]] = 'Stephen A. Douglas (Northern Democrats)';
            color = '#40e0d0';
          }
          if(counts[0][0] === 'Southern Democrat'){
            state_choices_1860[feature_states[i]] = 'John C. Breckinridge (Southern Democrats)';
            color = '#6699cc';
          }
          if(counts[0][0] === 'Constitutional Union'){ 
            state_choices_1860[feature_states[i]] = 'John J.Crittenden (Constitutional Union Party)';
            color = '#ffa500';
          }
          if(counts[0][0] === 'Fusion'){ 
            console.log("ISSUE: "+feature_states[i])
          }
          if(feature_states[i] === 'New Jersey'){ //split between lincoln (4) and douglass (3)
            color = '#a35c73';
          }
        }
      }
      map.addLayer({
        'id': feature_states[i],
        'type': 'fill',
        'source': feature_states[i],
        'layout': {},
        'paint': {
          'fill-color': color,
          'fill-opacity': 0.8
          //'fill-outline-color': '#000'
        }
      });
    }
  }
  map.on('click', function(e) {
    let states = map.queryRenderedFeatures(e.point, {
      layers: mouse_list
    });
    if(states.length > 0){
      document.getElementById('candidates_box_hover').style.display = 'none';
      document.getElementById('candidates_vote_table').innerHTML = ''; 
      clicked_election_state = true;
      //if(state_hovered !== states[0].properties.name){
        state_hovered = states[0].properties.name;
        if(state_hovered === 'Colorado' || state_hovered === 'Nebraska'){
          document.getElementById('candidates_text').innerText = state_hovered + ' was not a state at the time, and was considered '
            + territories_1860[states_to_terrs_1860[state_hovered]].info;
        }else if(state_hovered === 'West Virginia'){
          document.getElementById('candidates_text').innerText = state_hovered + 
            ' was not a state at the time, a part of Virginia. It later became a state in 1863 and participated in the 1864 election (head to 1864 for more info!).';
        }else if(states_to_terrs_1860[state_hovered] !== undefined){ //territory at the time
          document.getElementById('candidates_text').innerText = state_hovered + 
            ' was not a state at the time, and was considered to be ' + states_to_terrs_1860[state_hovered] + '. ';
            //+ territories_1860[states_to_terrs_1860[state_hovered]].info;
        }else{
          if(state_hovered !== 'New Jersey'){
            document.getElementById('candidates_text').innerText = state_hovered + ' was a part of the election, and voted for ' 
              + state_choices_1860[state_hovered] + '.';
          }else{
            document.getElementById('candidates_text').innerText = state_hovered + ' was a part of the election, and split the electoral ' 
              + 'vote between Abraham Lincoln (Republican) and Stephen A. Douglass (Northern Democrat).';
          }
          let state_counts =  {};
          let total_votes = 0;
          let state_1860 = election_data_1860[state_hovered];
          let sr_c = state_1860.r_c.split(',').join('');
          let snd_c = state_1860.nd_c.split(',').join('');
          let ssd_c = state_1860.sd_c.split(',').join('');
          let scu_c = state_1860.cu_c.split(',').join('');
          let sf_c = state_1860.f_c.split(',').join('');
          if(!isNaN(parseInt(sr_c)) && parseInt(sr_c) !== undefined){
            total_votes += parseInt(sr_c);
            state_counts['Republican'] = parseInt(sr_c);
          }
          if(!isNaN(parseInt(snd_c)) && parseInt(snd_c) !== undefined){
            total_votes += parseInt(snd_c);
            state_counts['Northern Democrat'] = parseInt(snd_c);
          }
          if(!isNaN(parseInt(ssd_c)) && parseInt(ssd_c) !== undefined){
            total_votes += parseInt(ssd_c);
            state_counts['Southern Democrat'] = parseInt(ssd_c);
          }
          if(!isNaN(parseInt(scu_c)) && parseInt(scu_c) !== undefined){
            total_votes += parseInt(scu_c);
            state_counts['Constitutional Union'] = parseInt(scu_c);
          }
          if(!isNaN(parseInt(sf_c)) && parseInt(sf_c) !== undefined){
            total_votes += parseInt(sf_c);
            state_counts['Fusion'] = parseInt(sf_c);
          }
          let r_percent = 'N/A';
          let nd_percent = 'N/A';
          let sd_percent = 'N/A';
          let cu_percent = 'N/A';
          let f_percent = 'N/A';
          if(state_counts['Republican'] !== undefined)
            r_percent = (parseInt(state_1860.r_c.split(',').join('')) / total_votes * 100).toFixed(2);
          if(state_counts['Northern Democrat'] !== undefined)
            nd_percent = (parseInt(state_1860.nd_c.split(',').join('')) / total_votes * 100).toFixed(2);
          if(state_counts['Southern Democrat'] !== undefined)
            sd_percent = (parseInt(state_1860.sd_c.split(',').join('')) / total_votes * 100).toFixed(2);
          if(state_counts['Constitutional Union'] !== undefined)
            cu_percent = (parseInt(state_1860.cu_c.split(',').join('')) / total_votes * 100).toFixed(2);
          if(state_counts['Fusion'] !== undefined)
            f_percent = (parseInt(state_1860.f_c.split(',').join('')) / total_votes * 100).toFixed(2);          
          let table = document.createElement('TABLE');
          let parties = document.createElement('TBODY');
          let header = document.createElement('TR');
          let columns = ['Party', 'Popular Vote Count', '% of Popular Vote', 'Electoral Vote Count'];
          let rows = ['Republican', 'Northern Democrat', 'Southern Democrat', 'Constitutional Union', 'Fusion'];
          for(let i = 0; i < columns.length; i++){
            let td = document.createElement('TD');
            td.width = '75';
            td.appendChild(document.createTextNode(columns[i]));
            header.appendChild(td);
          }
          parties.appendChild(header);
          for(let i = 0; i < rows.length; i++){
            let party = document.createElement('TR');
            let td_header = document.createElement('TD');
            td_header.width = '75';
            td_header.appendChild(document.createTextNode(rows[i]));
            party.appendChild(td_header);
            let texts = [];
            let electoral = '';
            if(rows[i] === 'Republican'){
              texts.push(election_data_1860[state_hovered].r_c + '');
              texts.push(r_percent + '');
              electoral = election_data_1860[state_hovered].r_e;
            }
            if(rows[i] === 'Northern Democrat'){
              texts.push(election_data_1860[state_hovered].nd_c + '');
              texts.push(nd_percent + '');
              electoral = election_data_1860[state_hovered].nd_e;
            }
            if(rows[i] === 'Southern Democrat'){
              texts.push(election_data_1860[state_hovered].sd_c + '');
              texts.push(sd_percent + '');
              electoral = election_data_1860[state_hovered].sd_e;
            }
            if(rows[i] === 'Constitutional Union'){
              texts.push(election_data_1860[state_hovered].cu_c + '');
              texts.push(cu_percent + '');
              electoral = election_data_1860[state_hovered].cu_e;
            }
            if(rows[i] === 'Fusion'){
              texts.push(election_data_1860[state_hovered].f_c + '');
              texts.push(f_percent + '');
              electoral = election_data_1860[state_hovered].f_e;
            }
            let electoral_text = '';
            if(parseInt(electoral) !== NaN && parseInt(electoral) !== undefined){
              if(parseInt(electoral) > -1){
                electoral_text = electoral + '';
              }else{
                electoral_text = '0';
              }
            }else{
              electoral_text = '0';
            }
            texts.push(electoral_text);
            for(let j = 0; j < texts.length; j++){ //single box
              let td = document.createElement('TD');
              td.width = '75';
              td.appendChild(document.createTextNode(texts[j]));
              party.appendChild(td);
            }
            parties.appendChild(party);
          }
          table.appendChild(parties);
          document.getElementById('candidates_vote_table').appendChild(table);
        //}
      }
      document.getElementById('candidates_box').style.display = 'block';
    }
  });
  map.on('mousemove', function(e) {
    let states = map.queryRenderedFeatures(e.point, {
      layers: mouse_list
    });
    if(states.length > 0){
      if(clicked_election_state === false){ //state_hovered !== states[0].properties.name && 
        state_hovered = states[0].properties.name;
        document.getElementById('state_hover_long_text').innerHTML = 'Click to see more about the state.';
        document.getElementById('candidates_box_hover').style.display = 'block';
        if(state_hovered === 'Colorado'){
          document.getElementById('state_hover_text').innerText = state_hovered;
        }else if(state_hovered === 'West Virginia'){
          document.getElementById('state_hover_text').innerText = state_hovered + ' (Virginia)';
        }else if(states_to_terrs_1860[state_hovered] !== undefined){
          document.getElementById('state_hover_text').innerText = state_hovered + ' (' + states_to_terrs_1860[state_hovered] + ')'; 
        }else{
          document.getElementById('state_hover_text').innerText = state_hovered;
        }
      }
    }else{
      document.getElementById('candidates_box_hover').style.display = 'none';
    }
  });
}

let state_choices_1864 = {};
function showElection1864(){
  //November 8, 1864
  //"no popular vote"
  let state_names_1864 = Object.keys(election_data_1864);
  let feature_states = [];
  for(let i = 0; i < stateBounds.features.length; i++){
    feature_states.push(stateBounds.features[i].properties.name);
  }
  election_button = true;
  for(let i = 0; i < feature_states.length; i++){
    let name_index = state_names.indexOf(feature_states[i]);
    if(name_index > -1){
      mouse_list.push(feature_states[i]);
      let feature  = {"type":"FeatureCollection","features":[stateBounds.features[i]]};
      map.addSource(feature_states[i], {
        type: 'geojson',
        data: feature
      });
      let color = '#edc9af';  //color for if it was still a territory
      let name_index_1864 = state_names_1864.indexOf(feature_states[i]);
      //it's an elections state it's either red or blue
      if(name_index_1864 > -1){
        //'Louisiana':{'nu_count':'no popular vote','nu_electoral':'7','dem_count':'no popular vote','dem_electoral':'-1'},
        let state_1864 = election_data_1864[feature_states[i]];
        if(parseInt(state_1864.nu_electoral) > parseInt(state_1864.dem_electoral)){
          state_choices_1864[feature_states[i]] = 'Abraham Lincoln (National Union Party)';
          color = '#de1738';
        }else{ //since they dont split electoral votes
          state_choices_1864[feature_states[i]] = 'George B. McClellan (Democrat Party)';
          color = '#0015BC';
        }
  
      }else{  
        let confed_index = confed_states_1864.indexOf(feature_states[i]);
        //part of confederacy at the time
        if(confed_index > -1){
          color = '#808080';
        }
      }
      map.addLayer({
        'id': feature_states[i],
        'type': 'fill',
        'source': feature_states[i],
        'layout': {},
        'paint': {
          'fill-color': color,
          'fill-opacity': 0.8
          //'fill-outline-color': '#000'
        }
      });
      //map.moveLayer('heatmap_layer', feature_states[i]);
    }
  }
  map.on('click', function(e) {
    let states = map.queryRenderedFeatures(e.point, {
      layers: mouse_list
    });
    if(states.length > 0){
      document.getElementById('candidates_box_hover').style.display = 'none';
      document.getElementById('candidates_vote_table').innerHTML = ''; 
      clicked_election_state = true;
      //if(state_hovered !== states[0].properties.name){
        state_hovered = states[0].properties.name;
        if(states_to_terrs_1864[state_hovered] !== undefined){ //territory at the time
          document.getElementById('candidates_text').innerText = state_hovered + 
            ' was not a state at the time, and was considered to be ' + states_to_terrs_1864[state_hovered] + '. ';
            //+ territories_1864[states_to_terrs_1864[state_hovered]].info;
        }else if(state_hovered === 'Tennessee' || state_hovered === 'Louisiana'){
          document.getElementById('candidates_text').innerText = state_hovered + ' recently became under control for the most part by Union forces, and was able to cast electoral votes. However Congress, due to the firm control of Radical Republicans at the time, denied their votes from counting. This would not have changed the overall election outcome however.';
        }else if(confed_states_1864.includes(state_hovered)){ //inside confederacy at the time
          document.getElementById('candidates_text').innerText = state_hovered + ' was part of the Confederacy at the time and thus was not part of the election.';
        }else{
          document.getElementById('candidates_text').innerText = state_hovered + ' was a part of the election, and voted for ' 
            + state_choices_1864[state_hovered] + '.';
          let total_votes = parseInt(election_data_1864[state_hovered].nu_count) + parseInt(election_data_1864[state_hovered].dem_count);
          let nu_percent = parseInt(election_data_1864[state_hovered].nu_count) / total_votes * 100;
          let dem_percent = parseInt(election_data_1864[state_hovered].dem_count) / total_votes * 100;
          let table = document.createElement('TABLE');
          let parties = document.createElement('TBODY');
          let header = document.createElement('TR');
          let columns = ['Party', 'Popular Vote Count', '% of Popular Vote', 'Electoral Vote Count'];
          let rows = ['National Union', 'Democrat'];
          for(let i = 0; i < columns.length; i++){
            let td = document.createElement('TD');
            td.width = '75';
            td.appendChild(document.createTextNode(columns[i]));
            header.appendChild(td);
          }
          parties.appendChild(header);
          for(let i = 0; i < rows.length; i++){
            let party = document.createElement('TR');
            let td_header = document.createElement('TD');
            td_header.width = '75';
            td_header.appendChild(document.createTextNode(rows[i]));
            party.appendChild(td_header);
            let texts = [];
            let electoral = '';
            if(rows[i] === 'National Union'){
              texts.push(election_data_1864[state_hovered].nu_count + '');
              texts.push(nu_percent.toFixed(2) + '');
              electoral = election_data_1864[state_hovered].nu_electoral;
            }else{
              texts.push(election_data_1864[state_hovered].dem_count + '');
              texts.push(dem_percent.toFixed(2) + '');
              electoral = election_data_1864[state_hovered].dem_electoral;
            }
            let electoral_text = '';
            if(parseInt(electoral) !== NaN && parseInt(electoral) !== undefined){
              if(parseInt(electoral) > -1){
                electoral_text = electoral + '';
              }else{
                electoral_text = '0';
              }
            }else{
              electoral_text = '0';
            }
            texts.push(electoral_text);
            for(let j = 0; j < texts.length; j++){ //single box
              let td = document.createElement('TD');
              td.width = '75';
              td.appendChild(document.createTextNode(texts[j]));
              party.appendChild(td);
            }
            parties.appendChild(party);
          }
          table.appendChild(parties);
          document.getElementById('candidates_vote_table').appendChild(table);
        //}
      }
      document.getElementById('candidates_box').style.display = 'block';
    }
  });
  map.on('mousemove', function(e) {
    let states = map.queryRenderedFeatures(e.point, {
      layers: mouse_list
    });
    if(states.length > 0){
      if(clicked_election_state === false){ //state_hovered !== states[0].properties.name && 
        document.getElementById('state_hover_long_text').innerHTML = 'Click to see more about the state.';
        state_hovered = states[0].properties.name;
        document.getElementById('candidates_box_hover').style.display = 'block';
        if(states_to_terrs_1864[state_hovered] !== undefined){
          document.getElementById('state_hover_text').innerText = state_hovered + ' (' + states_to_terrs_1864[state_hovered] + ')'; 
        }else{
          document.getElementById('state_hover_text').innerText = state_hovered;
        }
      }
    }else{
      document.getElementById('candidates_box_hover').style.display = 'none';
    }
  });
}
function deleteMarkers() {
  let cm_keys = Object.keys(current_markers);
  for(let i = 0; i < cm_keys.length; i++){
    current_markers[cm_keys[i]]['marker'].remove();
  }
  current_markers = {};
}

function applySettings(){
  if(document.getElementById('heatmap_select').value === 'heatmap_all'){
    if(map.getLayer('heatmap_layer')){
      map.removeLayer('heatmap_layer');
    }
    if(map.getSource('battle_points')){
      map.removeSource('battle_points');
    }
    constructHeatmap(-1);
  }
  if(document.getElementById('heatmap_select').value === 'heatmap_per_year'){
    if(map.getLayer('heatmap_layer')){
      map.removeLayer('heatmap_layer');
    }
    if(map.getSource('battle_points')){
      map.removeSource('battle_points');
    }
    constructHeatmap(parseInt(year));
  }

  if(document.getElementById('heatmap_only_choice').checked){
    deleteMarkers();
  }else{
    setUpPoints(year + '');
  }
  document.getElementById("settings_modal").style.display = 'none';
}

/*
      <div id="timeline">
        <p id="timeline_date">Yo</p>
        <input type="range" min="1" max="100" value="5">
      </div>

      slidebar_activate

            <div id="timeline">
        <p id="timeline_date">Yo</p>
        <input id="timeline_value" type="range" min="1" max="100" value="5" class="slider">
      </div>
*/
function runTimeline(){
  document.getElementById('heatmap_part').style.display = 'none';
  document.getElementById('timeline_value').value = 0;
  document.getElementById('timeline').style.display = 'block';
  document.getElementById('slidebar_activate').innerText = 'Stop animation';
  document.getElementById('slidebar_activate').onclick = 'stopTimeline()';
  removeWorldData();
  deleteMarkers();
  clearElection();
  setInterval(function() {
    let c_keys = Object.keys(civil_war_battles);
    let battle_name = c_keys[document.getElementById('timeline_value').value];
    let battle = battles_in_year[battle_name]
    let year = battle['date'].split(',')[1];
    let battle_date_parsed = battle['date'].split('-');
    let month_day = battle_date_parsed[0];
    if(battle_date_parsed.length === 1){
      month_day = battle['date'].split(',')[0];
    }
    let month = month_day.split(' ')[0];
    let day = parseInt(month_day.split(' ')[1]);
    document.getElementById('timeline_date').innerText = month + ' ' + day + ', ' + year;
    document.getElementById('timeline_value').value++;

    let battle_loc = civil_war_battles_geo[battle_name]['lat_lng'];
    let battle_lat = parseFloat(battle_loc.split(",")[0]);
    let battle_lng = parseFloat(battle_loc.split(",")[1]);
    let el = document.createElement('div');
    el.id = battle_name;
    if(battle['class'] === 'A')
      el.style.backgroundImage = 'url(\'images/a_battle.png\')'; 
    if(battle['class'] === 'B')
      el.style.backgroundImage = 'url(\'images/b_battle.png\')'; 
    if(battle['class'] === 'C')
      el.style.backgroundImage = 'url(\'images/c_battle.png\')'; 
    if(battle['class'] === 'D')
      el.style.backgroundImage = 'url(\'images/d_battle.png\')';
    el.style.borderRadius = 6 + 'px';
    el.style.width = 30 + 'px';
    el.style.height = 30 + 'px';
    let marker = new mapboxgl.Marker(el)
      .setLngLat([battle_lng, battle_lat])
      .addTo(map);
    el.addEventListener('click', setMarkerName, false);
    current_markers[battle_name] = {'marker': marker, 'lat': battle_lat, 'lon': battle_lng};
  }, 600);
}

function stopTimeline(){
console.log("stop")
}

function assembleYearData(){
  document.getElementById('battles_by_state').innerHTML = '';
  let confed_vict_count = 0;
  let union_vict_count = 0;
  let tie_count = 0;
  let class_a_count = 0;
  let class_b_count = 0;
  let class_c_count = 0;
  let class_d_count = 0;
  let u_class_a_count = 0;
  let u_class_b_count = 0;
  let u_class_c_count = 0;
  let u_class_d_count = 0;
  let c_class_a_count = 0;
  let c_class_b_count = 0;
  let c_class_c_count = 0;
  let c_class_d_count = 0;
  let states_dict = {};
  for(var battle_name in civil_war_battles){
    let battle = civil_war_battles[battle_name];
    let date = battle['date'].split(',');
    let state_name_parsed = civil_war_battles_geo[battle_name].place.split(',');
    let state = state_name_parsed[state_name_parsed.length - 1];
    //battles occurring in multiple states are not double counted in the state table
    if(parseInt(year) === parseInt(date[1])){  
      if(battle['class'] === 'A')
        class_a_count++;
      if(battle['class'] === 'B')
        class_b_count++;
      if(battle['class'] === 'C')
        class_c_count++;
      if(battle['class'] === 'D')
        class_d_count++;
      //find which state
      for(let i = 0; i < state_names.length; i++){
        if(state.includes(state_names[i])){
          state = state_names[i];
          break;
        }
      }
      if(battle['victory'] === 'Inconclusive'){
        tie_count++;
        if(states_dict[state] !== undefined){
          states_dict[state].tie_count++;
          states_dict[state].total_count++;
        }else{
          states_dict[state] = {'total_count': 1, "union_vict": 0, "confed_vict": 0, "tie_count": 1};
        }
      }else if(battle['victory'] === 'Union'){
        union_vict_count++;
        if(states_dict[state] !== undefined){
          states_dict[state].union_vict++;
          states_dict[state].total_count++;
        }else{
          states_dict[state] = {'total_count': 1, 'union_vict': 1, 'confed_vict': 0, 'tie_count': 0};
        }
        if(battle['class'] === 'A')
          u_class_a_count++;
        if(battle['class'] === 'B')
          u_class_b_count++;
        if(battle['class'] === 'C')
          u_class_c_count++;
        if(battle['class'] === 'D')
          u_class_d_count++;
      }else if(battle['victory'] === 'Confederate'){
        confed_vict_count++;
        if(states_dict[state] !== undefined){
          states_dict[state].confed_vict++;
          states_dict[state].total_count++;
        }else{
          states_dict[state] = {'total_count': 1, 'union_vict': 0, 'confed_vict': 1, 'tie_count': 0};
        }
        if(battle['class'] === 'A')
          c_class_a_count++;
        if(battle['class'] === 'B')
          c_class_b_count++;
        if(battle['class'] === 'C')
          c_class_c_count++;
        if(battle['class'] === 'D')
          c_class_d_count++;
      }
    }
  }
  let total_year = class_a_count + class_b_count + class_c_count + class_d_count;
  document.getElementById('year_count_text').innerHTML = 'The total number of principal battles fought this year in ' 
    + year + ' was ' + total_year + '.';

  let class_a_percent = (class_a_count / total_year) * 100;
  let class_b_percent = (class_b_count / total_year) * 100;
  let class_c_percent = (class_c_count / total_year) * 100;
  let class_d_percent = (class_d_count / total_year) * 100;
  document.getElementById('class_comp_text').innerHTML = 'Under CSWAC classifications, ' + class_a_percent.toFixed(2) + 
    '% of the battles were decisive, ' + class_b_percent.toFixed(2) + '% were major engagements, ' + 
    class_c_percent.toFixed(2) + '% were formative engagements, and '+ class_d_percent.toFixed(2) + 
    '% were limited engagements.';

  let union_win_percent = (union_vict_count / total_year) * 100;
  let confed_win_percent = (confed_vict_count / total_year) * 100;
  let tie_percent = (tie_count / total_year) * 100;
  document.getElementById('victor_text').innerHTML =  'This year, ' + union_win_percent.toFixed(2) + 
    '% of the battles were Union victories, ' + confed_win_percent.toFixed(2)+ 
    '% of the battles were Confederate victories, and ' + tie_percent.toFixed(2) + 
    '% of the battles were inconclusive. Note that a few of the classified battles were not strictly a Union v. Confederate engagement, as Native American tribes were involved in certain battles.';
  
  let u_total_year = u_class_a_count + u_class_b_count + u_class_c_count + u_class_d_count;
  let u_class_a_percent = (u_class_a_count / u_total_year) * 100;
  let u_class_b_percent = (u_class_b_count / u_total_year) * 100;
  let u_class_c_percent = (u_class_c_count / u_total_year) * 100;
  let u_class_d_percent = (u_class_d_count / u_total_year) * 100;

  let c_total_year = c_class_a_count + c_class_b_count + c_class_c_count + c_class_d_count;
  let c_class_a_percent = (c_class_a_count / c_total_year) * 100;
  let c_class_b_percent = (c_class_b_count / c_total_year) * 100;
  let c_class_c_percent = (c_class_c_count / c_total_year) * 100;
  let c_class_d_percent = (c_class_d_count / c_total_year) * 100;
  document.getElementById('of_victor_text').innerHTML =  'Of the Union victories, ' + u_class_a_percent.toFixed(2) + '% were classified as decisive engagements, ' + 
    u_class_b_percent.toFixed(2) + '% classified as major engagements, ' + u_class_c_percent.toFixed(2) + '% were classified as formative engagements, and ' + 
    u_class_d_percent.toFixed(2) + '% were classified as limited engagements. Of the Confederate victories, ' + c_class_a_percent.toFixed(2) + 
    '% were classified as decisive engagements, ' + c_class_b_percent.toFixed(2) + '% classified as major engagements, ' + c_class_c_percent.toFixed(2) + 
    '% were classified as formative engagements, and ' + c_class_d_percent.toFixed(2) + '% were classified as limited engagements.';

  let state_data_header = document.createElement('tr');   
  let state_td_header = document.createElement('td');
  let total_td_header = document.createElement('td');
  let union_td_header = document.createElement('td');
  let confed_td_header = document.createElement('td');    
  let ties_td_header = document.createElement('td');   

  let state_txt_header = document.createTextNode('Victors');
  let total_txt_header = document.createTextNode('Total');
  let union_txt_header = document.createTextNode('Union');
  let confed_txt_header = document.createTextNode('Confederacy');
  let ties_txt_header = document.createTextNode('Tie');
  state_td_header.appendChild(state_txt_header);
  total_td_header.appendChild(total_txt_header);
  union_td_header.appendChild(union_txt_header);
  confed_td_header.appendChild(confed_txt_header);
  ties_td_header.appendChild(ties_txt_header);
  let table_header = document.createElement('tr');   
  table_header.appendChild(state_td_header);
  table_header.appendChild(total_td_header);
  table_header.appendChild(union_td_header);
  table_header.appendChild(confed_td_header);
  table_header.appendChild(ties_td_header);
  document.getElementById('battles_by_state').appendChild(table_header);
  let state_counts_keys = Object.keys(states_dict);
  //account for 1860 boundaries
  for (var i = 1; i < state_counts_keys.length; i++){
    let state_data = document.createElement('tr');   
    let state_td = document.createElement('td');
    let total_td = document.createElement('td');
    let union_td = document.createElement('td');
    let confed_td = document.createElement('td');  
    let ties_td = document.createElement('td');   
    let state_txt = document.createTextNode(state_counts_keys[i]);
    let total_txt = document.createTextNode(states_dict[state_counts_keys[i]].total_count + '');
    let union_txt = document.createTextNode(states_dict[state_counts_keys[i]].union_vict + '');
    let confed_txt = document.createTextNode(states_dict[state_counts_keys[i]].confed_vict + '');
    let ties_txt = document.createTextNode(states_dict[state_counts_keys[i]].tie_count + '');

    state_td.appendChild(state_txt);
    total_td.appendChild(total_txt);
    union_td.appendChild(union_txt);
    confed_td.appendChild(confed_txt);
    ties_td.appendChild(ties_txt);

    state_data.appendChild(state_td);
    state_data.appendChild(total_td);
    state_data.appendChild(union_td);
    state_data.appendChild(confed_td);
    state_data.appendChild(ties_td);
    document.getElementById('battles_by_state').appendChild(state_data);
  }
}

function showYearReport(){
  /*
    funtion here to to that 
    <div id='report_modal' class='modal' style='display:none;'> 
      <div id='report' class='modal-content' style="text-align: center;">
        <span id='report_close' class='close' style="float: right;">&times;</span>
        <p id='loading'>Number of major battles this year: </p>
        <br>
        <p id='loading'>percentage of principal battles by class</p>
        <br>
        <p id='loading'>percentage of battles won by confederate or union</p>
        <br>
        <p id='loading'>table here of battles and percentage wins by state</p>
        <button id="apply_settings" class="button" onclick="applySettings()">Apply Settings</button>
      </div>
    </div>
  */
  assembleYearData();
  document.getElementById('report_modal').style.display = 'block';
}

function showSettings(){
  document.getElementById('settings_modal').style.display = 'block';
}

function showNews(array) {
  console.log("slide: "+slideIndex+", array_length: "+array.length)
  if(slideIndex >= array.length){
    slideIndex = 0;
  }
  if(slideIndex < 0){
    slideIndex = array.length - 1;
  }
  let imageid = 'image';
  document.getElementById(imageid).src = array[slideIndex]["src"];
  document.getElementById(imageid).onclick = 'window.location.href = \'' + array[slideIndex]["url"] + '\'';
  document.getElementById(imageid).style.display = 'block'; 
  let titleid = 'title'; 
  document.getElementById(titleid).innerHTML = array[slideIndex]["title"];
  document.getElementById(titleid).style.display = 'block';
}

function getGeneralInfo(){
  document.getElementById('general_info').style.display = 'block'; 
  document.getElementById('relics_modal').style.display = 'none';
  document.getElementById('image').style.display = 'none'; 
  document.getElementById('left').style.display = 'none'; 
  document.getElementById('right').style.display = 'none'; 
  document.getElementById('title').style.display = 'none'; 
  document.getElementById('loading').style.display = 'none';
}

function getImages(){
  console.log(images_url)
  document.getElementById('general_info').style.display = 'none'; 
  document.getElementById('relics_modal').style.display = 'block';
  document.getElementById('image').style.display = 'none'; 
  document.getElementById('left').style.display = 'none'; 
  document.getElementById('right').style.display = 'none'; 
  document.getElementById('title').style.display = 'none'; 
  document.getElementById('loading').style.display = 'block';
  $.getJSON('http://www.whateverorigin.org/get?url=' + encodeURIComponent(images_url) + '&callback=?', function(data){
    //move point along a line: https://docs.mapbox.com/mapbox-gl-js/example/animate-point-along-route/
    //e.target.style.backgroundImage = 'url(http://placekitten.com/g/50/50)';
    //e.stopPropagation();
    //console.log(e.target.style.backgroundImage);
    //pull up relevant youtube video
    console.log(data)
    console.log(data.contents);
    console.log(data.contents.results);
    let images = [];
    for(let i = 0; i < data.contents.results.length; i++){
      let d = data.contents.results[i];
      if(d.access_restricted === false){ 
        // FOR GETTING HOMEFRONT OPINION
        //data.contents.results[0].access_restricted -> make sure true
        //data.contents.results[0].id -> newspaper link online 
        //data.contents.results[0].date '1914-2-5' split by '-' and search for matching year,  .image_url -> array, .png url src links, .description array to headline
        //.location -> ['united states', 'new york city', 'new york', 'new york county']
        //.partof_title -> ['new-york tribune (new york [n.y.]) 1866-1924'] -> ALL CAP IT
        if(d.date !== undefined && d.image_url !== undefined){
          if(d.image_url.length > 0){
            let time = d.date.split('-');
            for(let j = 0; j < time.length; j++){
              let num = parseInt(time[j]);
              if(num >= year && num <= 1865){ //its a year, not month or day
                images.push(d);
                break;
              }
            }
          }
        }
      }
    }
    let featured = false;
    if(images.length === 0){
      featured = true;
      for(let i = 0; i < data.contents.featured_items.length; i++){
        let d = data.contents.featured_items[i];
        let t = d.title.split(" ");
        for(let j = 0; j < t.length; j++){
          let num = parseInt(t[j]);
          if(num !== undefined){
            if(num >= year && num <= 1865){ //its a year, not month or day
              images.push(d);
              break;
            }
          }
        }
      }
    }
    console.log("IMAGES")
    console.log(images)
    for(let j = 0; j < images.length; j++){
      if(featured === false){
        let url_pos = -1;
        for(let k = images[j].image_url.length - 1; k >= 0; k--){
          if(images[j].image_url[k].indexOf('.jpg') > -1 || images[j].image_url[k].indexOf('.png') > -1){
            url_pos = k;
            break;
          }
        }
        if(url_pos !== -1){
          relics.push({"src": images[j].image_url[url_pos], "title": images[j].title, "url": images[j].url}); 
        }
      }else{
        relics.push({"src": 'https://loc.gov' + images[j].image, "title": images[j].title, "url": 'https://loc.gov' + images[j].url}); 
      }  
    }
    document.getElementById('loading').style.display = 'none';
    console.log("relics size: "+relics.length);
    if(relics.length > 0){
      document.getElementById('image').style.display = 'block';
      document.getElementById('left').style.display = 'block';
      document.getElementById('right').style.display = 'block';
      for(let i = relics.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        let temp = relics[i];
        relics[i] = relics[j];
        relics[j] = temp;
      }
      console.log("RELICS")
      console.log(relics);
      slideIndex = 0;
      showNews(relics);
    }else{
      document.getElementById('title').innerHTML = "No relics were found";
      document.getElementById('title').style.display = 'block';
      console.log("LENGTH: 0")
    }
  });
}

//get library of congress newspapers
function getHomefront(){
  console.log(newspapers_url)
  document.getElementById('general_info').style.display = 'none'; 
  document.getElementById('relics_modal').style.display = 'block';
  document.getElementById('image').style.display = 'none'; 
  document.getElementById('left').style.display = 'none'; 
  document.getElementById('right').style.display = 'none'; 
  document.getElementById('title').style.display = 'none'; 
  document.getElementById('loading').style.display = 'block';
  $.getJSON('http://www.whateverorigin.org/get?url=' + encodeURIComponent(newspapers_url) + '&callback=?', function(data){
    //move point along a line: https://docs.mapbox.com/mapbox-gl-js/example/animate-point-along-route/
    //e.stopPropagation();
    //console.log(e.target.style.backgroundImage);
    //pull up relevant youtube video
    console.log(data)
    //console.log(data.contents);
    //console.log(data.contents.results);
    let news = [];
    for(let i = 0; i < data.contents.results.length; i++){
      let d = data.contents.results[i]
      if(d.access_restricted === false){ 
        // FOR GETTING HOMEFRONT OPINION
        //data.contents.results[0].access_restricted -> make sure true
        //data.contents.results[0].id -> newspaper link online 
        //data.contents.results[0].date '1914-2-5' split by '-' and search for matching year,  .image_url -> array, .png url src links, .description array to headline
        //.location -> ['united states', 'new york city', 'new york', 'new york county']
        //.partof_title -> ['new-york tribune (new york [n.y.]) 1866-1924'] -> ALL CAP IT
        if(d.date !== undefined && d.image_url !== undefined){
          if(d.image_url.length > 0){
            let time = d.date.split('-');
            for(let j = 0; j < time.length; j++){
              let num = parseInt(time[j]);
              if(num >= year && num <= 1865){ //its a year, not month or day
                news.push(d);
                break;
              }
            }
          }
        }
      }
    }
    let featured = false;
    if(news.length === 0){
      featured = true;
      for(let i = 0; i < data.contents.featured_items.length; i++){
        let d = data.contents.featured_items[i];
        let t = d.title.split(' ');
        for(let j = 0; j < t.length; j++){
          let num = parseInt(t[j]);
          if(num !== undefined){
            if(num >= year && num <= 1865){ //its a year, not month or day
              news.push(d);
              break;
            }
          }
        }
      }
    }
    console.log("NEWS")
    console.log(news)
    for(let j = 0; j < news.length; j++){
      if(featured === false){
        let url_pos = -1;
        for(let k = news[j].image_url.length - 1; k >= 0; k--){
          if(news[j].image_url[k].indexOf('.jpg') > -1 || news[j].image_url[k].indexOf('.png') > -1){
            url_pos = k;
            break;
          }
        }
        if(url_pos !== -1){
          relics.push({"src": news[j].image_url[url_pos], "title": news[j].title, "url": news[j].url}); 
        }
      }else{
        relics.push({"src": 'https://loc.gov' + news[j].image, "title": news[j].title, "url": 'https://loc.gov' + news[j].url}); 
      }  
    }
    getMaps();
  }); 
}

function nextBattle(){
  let keys = Object.keys(civil_war_battles_geo);
  let is_last_battle = false;
  let next_battle_index = keys.indexOf(battle_name) + 1;
  if(next_battle_index < keys.length){
    battle_name = keys[next_battle_index];
    let latlng = civil_war_battles_geo[battle_name]["lat_lng"].split(",");
    let latitude = parseFloat(latlng[0]);
    let longitude = parseFloat(latlng[1]);
    map.flyTo({
      center: [longitude, latitude],
      essential: true
    });
    loadBattle();
  }else{
    if((year + 1) <= 1865){
      year = year + 1;
      let year_s = year + "";
      document.getElementById("fly_to_next").style.display = 'none';
      preSetUpPoints(year_s);
    }else{
      console.log("last battle of the war we have data on")
    }
  }
}

//get library of congress battle maps
function getMaps(){
  console.log(maps_url)
  maps = [];
  document.getElementById('general_info').style.display = 'none'; 
  document.getElementById('loading').style.display = 'none'; 
  document.getElementById('relics_modal').style.display = 'block';
  document.getElementById('loading').style.display = 'block';
  document.getElementById('image').style.display = 'none';
  document.getElementById('left').style.display = 'none'; 
  document.getElementById('right').style.display = 'none'; 
  document.getElementById('title').style.display = 'none'; 
  $.getJSON('http://www.whateverorigin.org/get?url=' + encodeURIComponent(maps_url) + '&callback=?', function(data){
    //console.log(data);
    //console.log(data.contents);
    //console.log(data.contents.results);
    let battle_maps = [];
    for(let i = 0; i < data.contents.results.length; i++){
      let d = data.contents.results[i]
      if(d.access_restricted === false){ 
        // FOR GETTING HOMEFRONT OPINION
        //data.contents.results[0].access_restricted -> make sure true
        //data.contents.results[0].id -> newspaper link online 
        //data.contents.results[0].date '1914-2-5' split by '-' and search for matching year,  .image_url -> array, .png url src links, .description array to headline
        //.location -> ['united states', 'new york city', 'new york', 'new york county']
        //.partof_title -> ['new-york tribune (new york [n.y.]) 1866-1924'] -> ALL CAP IT
        if(d.date !== undefined && d.image_url !== undefined){
          if(d.image_url.length > 0){
            let time = d.date.split("-");
            for(let j = 0; j < time.length; j++){
              let num = parseInt(time[j]);
              if(num >= year && num <= 1945){ //its a year, not month or day, CHECK MONTH ALSO ->> BATTLE OF BULGE
                battle_maps.push(d);
                break;
              }
            }
          }
        }
      }
    }
    console.log("MAPS")
    console.log(battle_maps)
    for(let j = 0; j < battle_maps.length; j++){
      relics.push({"src": battle_maps[j].image_url[battle_maps[j].image_url.length - 1], "title": battle_maps[j].title, "url": battle_maps[j].url}); //LINE OF CHANGE
    }
    getImages();
  });
}

function getRelics(){
  //document.getElementById('get_relics').style.display = 'none';
  document.getElementById('image').style.display = 'none';
  getHomefront();
}

//https://en.wikipedia.org/wiki/List_of_American_Civil_War_battles
function setMarkerName(e) {
  battle_name = e.target.id;
  //console.log(battle_name)
  loadBattle();
}

function loadBattle(){
  //document.getElementById('get_relics').style.display = 'block';
  let newspapers = [];
  let maps = [];
  //library of congress api
  maps_url = 'https://www.loc.gov/collections/military-battles-and-campaigns/?fo=json&q=' + battle_name + '&st=gallery';
  images_url = 'https://www.loc.gov/photos/?fo=json&q=' + battle_name;
  //'https://www.loc.gov/maps/?q=' + battle_name + '&fo=json';
  newspapers_url = 'https://www.loc.gov/newspapers/?fo=json&q=' + battle_name;
  //'https://www.loc.gov/collections/military-battles-and-campaigns/?fo=json&' + battle_name;
  let battle_keys = Object.keys(civil_war_battles);
  let battle_pos = -1;
  for(let i = 0; i < battle_keys.length; i++){
    if(battle_keys[i] === battle_name){
      battle_pos = i;
      break;
    }
  }
  /*for(let i = 0; i < cm_keys.length; i++){
    current_markers[cm_keys[i]]['marker']._element.style.backgroundImage = 'url(\'usmaplogo.jpg\')';
  }*/
  //document.getElementById('info').innerHTML = '';
  if(document.getElementById('battle_title') !== null){
    document.getElementById('battle_title').style.display = 'none';
    document.getElementById('time_date').style.display = 'none';
    document.getElementById('location').style.display = 'none';
    document.getElementById('type').style.display = 'none';
    document.getElementById('facts').style.display = 'none';
    document.getElementById('outcome').style.display = 'none';
    document.getElementById('iframe').style.display = 'none';
  }
  //current_markers[battle_name]['marker']._element.style.backgroundImage = '';
  document.getElementById('general_info').style.display = 'block';
  //document.getElementById('info').innerHTML = '';
  document.getElementById('battle_title').style.display = 'block';
  document.getElementById('time_date').style.display = 'block';
  document.getElementById('location').style.display = 'block';
  document.getElementById('type').style.display = 'block';
  document.getElementById('facts').style.display = 'block';
  document.getElementById('outcome').style.display = 'block';
  document.getElementById('iframe').style.display = 'block';
  let battle_data = civil_war_battles[battle_keys[battle_pos]];
  let battle_data_geo = civil_war_battles_geo[battle_keys[battle_pos]];
  /*let battle_title = document.createElement('p');
  battle_title.id = 'battle_title';
  battle_title.innerHTML = battle_name;*/
  document.getElementById('battle_title').innerHTML = battle_name;
  //document.getElementById('info').appendChild(battle_title);

  /*let time_date = document.createElement('p');
  time_date.id = 'time_date';
  time_date.innerHTML = battle_data['start-date'].split('\n')[0] + ' - ' + battle_data['end-date'].split('\n')[0]; */
  document.getElementById('time_date').innerHTML = battle_data['date'];
  //document.getElementById('info').appendChild(time_date);
  
  /*let location = document.createElement('p');
  location.id = 'location';
  location.innerHTML = battle_data['location'].split('\n')[0];*/
  document.getElementById('location').innerHTML = battle_data_geo['place'];
  //document.getElementById('info').appendChild(location);
  let class_text = 'The battle was classified as ';
  if(battle_data['class'] === 'A')
    class_text += 'DECISIVE (class A) ';
  if(battle_data['class'] === 'B')
    class_text += 'MAJOR (class B) ';
  if(battle_data['class'] === 'C')
    class_text += 'FORMATIVE (class C) ';
  if(battle_data['class'] === 'D')
    class_text += 'LIMITED (class D) ';
  document.getElementById('type').innerHTML = class_text + ' by the <a href="http://npshistory.com/publications/battlefield/cwsac/report.pdf" style="color: black;">Civil War Sites Advisory Commission</a>.'
  //document.getElementById('info').appendChild(opposing);
  
  document.getElementById('facts').innerHTML = 'Info: ' + battle_data['notes'];
  
  /*let outcome = document.createElement('p');
  outcome.id = 'outcome';
  outcome.innerHTML = battle_data['result'].split('[')[0];*/
  document.getElementById('outcome').innerHTML = battle_data['victory'];
  if(battle_data['victory'].split(' ')[0] !== "Inconclusive"){
    document.getElementById('outcome').innerHTML = document.getElementById('outcome').innerHTML + ' victory';
  }
  //document.getElementById('info').appendChild(outcome);

  /*let iframe = document.createElement('iframe');
  iframe.id = 'iframe';
  iframe.src = 'https://www.youtube.com/embed/?listType=search&list=' + battle_name + ' battle footage&autoplay=1';
  iframe.width = '400';
  iframe.height = '300';*/
  document.getElementById('iframe').src = 'https://www.youtube.com/embed/?listType=search&list=' + battle_name + ' civil war&autoplay=1'; //battle of phillipi
  //document.getElementById('info').appendChild(iframe);

  /*document.getElementById('homefront_modal').style.display = 'block';
  document.getElementById('battle_map').style.display = 'block';
  document.getElementById('fly_to_next').style.display = 'block';*/ 
  if(battle_name === "Battle of Fort Blakeley"){
    document.getElementById('fly_to_next').style.display = 'none';
  }else{
    document.getElementById('fly_to_next').style.display = 'block'; //inline-block?
  }
}

let mouse_list_world = [];
let place_hovered = '';
function removeWorldData(){
  mouse_list_world = [];
  let places = ['Canada', 'Mexico', 'Australia', 'United Kingdom', 'Brazil', 'India', 'Russia', 'France', 'Ireland', 'Alaska', 'Hawaii'];
  for(let i = 0; i < places.length; i++){
    if(map.getLayer(places[i])){
      map.removeLayer(places[i]);
    }
    if(map.getSource(places[i])){
      map.removeSource(places[i]);
    }
  }
}
let world_info = {};
let clicked_nation = false;
function plotWorldData(year){
      /*
World bounds: 
//Canada, Mexico #006341, Australia #ab4b52, United Kingdom #ab4b52, Brazil #FFDF00, India #ab4b52, Russia #ffffff, France #0055A4, Ireland #ab4b52, 
Alaska #ffffff
worldBounds.features[i].properties.name
worldBounds.features[i].geometry.coordinates
      */
  mouse_list_world = [];
  let places = ['Canada', 'Mexico', 'Australia', 'United Kingdom', 'Brazil', 'India', 'Russia', 'France', 'Ireland', 'Alaska', 'Hawaii'];
  let place_colors = ['#ab4b52', '#006341', '#ab4b52', '#ab4b52', '#ffdf00', '#ab4b52', '#ffffff', '#0055a4', '#ab4b52', '#ffffff', '#b19cd9'];
  for(let i = 0; i < places.length; i++){
    let will_show = false;
    let place_html = '';
    if(places[i] === 'Canada'){
      place_html = 'Canada was still part of the British Empire during the war, as they became independent in 1867. ' 
        + 'They were neutral during the war, with only minor <a href="https://en.wikipedia.org/wiki/Canada_and_the_American_Civil_War" style="color: black;">cross-border incidents</a> by the Confederates inciting tensions between the '
        + 'Union and Confederacy. It is important to note though that much of the populace largely supported the Union.';
      will_show = true;
    }
    if(places[i] === 'Mexico' && parseInt(year) < 1864){
      place_html = 'Mexico was in the midst of its own turbulent <a href="https://en.wikipedia.org/wiki/Second_French_intervention_in_Mexico" style="color: black;">situation</a> throughout the entire American Civil War, as France ' + 
        'invaded the country to overthrow Mexico\'s liberal president Benito Juárez. He was unpopular by the ruling conservative elites ' +
        'and the Catholic Church, and France saw an opportunity with the Civil War plaguing America, to try and assert power in a region ' +
        'that was protected by the Monroe doctorine as a place for no European intervention.';
      will_show = true;
    }
    if(places[i] === 'Mexico' && parseInt(year) >= 1864){
      place_html = 'Austrian prince Maximillian I was now installed as ruler of Mexico, in the form of the Second Mexican Empire. Juarez and his forces '
       + 'continued the fight, and signs of the war shifting in favor of Juarez and the Mexican Republic would appear to show.';
       will_show = true;
    }
    if(places[i] === 'Australia'){
      place_html = 'Similar to India, Australia becomes more useful to Britain for its cotton production, as the Confederacy was in the midst of war. The Australian public\'s sympathies for either side were largely split.';
      will_show = true;
    }
    if(places[i] === 'United Kingdom'){
      place_html = 'The United Kingdom maintained neutrality throughout the conflict, though for the elites and big businesses, the Confederacy was the more sympathetic side. Oftentimes private businesses were producing ships and supplies for the Confederacy, '
       + 'and even transporting Confederate ambassadors to the United Kingdom. The latter means of support would lead to the <a href="https://en.wikipedia.org/wiki/Trent_Affair" style="color: black;">Trent Affair</a>, which was the incident that nearly caused war between them and the Union. '
       + 'The Union was more sympathetically viewed among the working class, most especially once Abraham Lincoln declared the Emancipation Proclamation and proclaimed the war to be over slavery, which was a very unpopular system among much of the British populace, given they recently outlawed it. '
       + 'The Confederacy was hoping for them and France to intervene on their side, but they never did since they didn\'t see much benefits from inciting war with the United States.';
      will_show = true;
    }
    if(places[i] === 'Brazil' && parseInt(year) === 1865){
      place_html = 'Of the Confederates who fled the United States upon the Confederacy\'s defeat, a majority went to Brazil to re-settle, as Brazil still had legalized slavery and relied on cotton production as well. Some actually remained there and started families and even founded a city called ' +
      ' <a href="https://en.wikipedia.org/wiki/Americana,_S%C3%A3o_Paulo" style="color: black;">Americana</a>.';
      will_show = true;
    }
    if(places[i] === 'India' && parseInt(year) === 1865){
      place_html = 'India was part of the British Empire at the time, and with the South collapsing, Britain sought to use India as their new primary source for cotton production.';
      will_show = true;
    }
    if(places[i] === 'France'){
      place_html = 'While a neutral nation like the all the other foreign powers, the French saw territorial opportunities in the North American region due to the conflict, and was sympathetic to the Confederacy'
        + ' in that regard, as evident when they would begin their intervention campaign in Mexico in 1861. However, they did seek to maintain a non-combative relationship with the Union during the war. The Confederacy was hoping for them and the British to intervene on their side, but they never did as they didn\'t see much benefits from inciting war with the United States.';
      will_show = true;
    }
    if(places[i] === 'Russia'){
      place_html = 'Russia was quite sympathetic to Union, one reason being to counterbalance the British government\'s sympathies for the Confederacy. At the time both nations were competing for global influence in ' + 
         'a period called <a href="https://en.wikipedia.org/wiki/The_Great_Game" style="color: black;">The Great Game</a>. ';
      will_show = true;
    }
    if(places[i] === 'Alaska'){
      place_html = 'Alaska was part of the Russian Empire at the time, and was purchased by the United States in 1867. Russia was quite sympathetic to Union, one reason being to counterbalance the British government\'s sympathies for the Confederacy. At the time both nations were competing for global influence in ' + 
         'a period called <a href="https://en.wikipedia.org/wiki/The_Great_Game" style="color: black;">The Great Game</a>. ';
      will_show = true;
    }
    if(places[i] === 'Ireland'){
      place_html = 'With the Great Famine occuring in Ireland ~15 years earlier, many Irish immigrating to the United States and would serve in the conflict, mostly on the <a href="https://en.wikipedia.org/wiki/Irish_Brigade_(Union_Army)" style="color: black;">Union</a> side.';
      will_show = true;    
    }
    if(places[i] === 'Hawaii'){
      place_html = 'Hawaii was an independent kingdom at the time, led by King Kamehameha IV. They were neutral during the conflict like all the other nations, though held sympathetic views largely towards the Union.';
      will_show = true;    
    }
    if(will_show){
      world_info[places[i]] = place_html;
      mouse_list_world.push(places[i]);
      let feature  = {"type":"FeatureCollection","features":[worldBounds.features[i]]};
      map.addSource(places[i], {
        type: 'geojson',
        data: feature
      });
      map.addLayer({
        'id': places[i],
        'type': 'fill',
        'source': places[i],
        'layout': {},
        'paint': {
          'fill-color': place_colors[i],
          'fill-opacity': 0.8
        }
      });
    }
  }
  map.on('mousemove', function(e) {
    let places = map.queryRenderedFeatures(e.point, {
        layers: mouse_list_world
      });
    if(!clicked_nation){
      if(places.length > 0){
        place_hovered = places[0].properties.name;
        document.getElementById('candidates_box_hover').style.display = 'block';
        document.getElementById('state_hover_text').innerText = place_hovered;
        document.getElementById('state_hover_long_text').innerHTML = 'Click to see more about the nation.';
      }else{
        document.getElementById('candidates_box_hover').style.display = 'none';
      }
    }
  });
  map.on('click', function(e) {
    clicked_nation = true;
    let places = map.queryRenderedFeatures(e.point, {
      layers: mouse_list_world
    });
    if(places.length > 0){
      place_hovered = places[0].properties.name;
      document.getElementById('nations_modal').style.display = 'block';
      document.getElementById('nations_text').innerText = place_hovered;
      document.getElementById('nations_modal_long_text').innerHTML = world_info[place_hovered];
    }else{
      document.getElementById('nations_modal').style.display = 'none';
    }
  });
}

function preSetUpPoints(year){
  document.getElementById('heatmap_sides').style.display = 'block';
  document.getElementById('heatmap_general').checked = true;
  clearElection();
  removeWorldData();
  let ids = ['1861', '1862', '1863', '1864', '1865'];
  for(let i = 0; i < ids.length; i++){
    document.getElementById(ids[i]).style.color = 'white';
  }
  document.getElementById(year).style.color = 'gold';
  document.getElementById('intro_text').innerHTML = year;
  /*<div id='intro_modal' class='modal' style='display:none;'> 
      <div id='intro' class='modal-content'>
        <p id='intro_text'></p>
        <p id='intro_long_text'></p>
        <br>
        <button id="intro_close" class="button">See battle map</button>
      </div>
    </div>*/
  if(parseInt(year) === 1861){
    document.getElementById('intro_long_text').innerHTML = 'The war commenced this year, with April 12 Confederate attack on Fort Sumter initiating hostilities. For a bit of context, see the "Recent Election!" tab to see the results of the 1860 election, which was one of the short term catalysts for the war starting.';
  }
  if(parseInt(year) === 1862){
    document.getElementById('intro_long_text').innerHTML = '';
  }
  if(parseInt(year) === 1863){
    document.getElementById('intro_long_text').innerHTML = '';
  }
  if(parseInt(year) === 1864){
    document.getElementById('intro_long_text').innerHTML = 'See the "Recent Election!" tab to see the 1864 eletions results.';
  }
  if(parseInt(year) === 1865){
    document.getElementById('intro_long_text').innerHTML = '';
  }
  document.getElementById('intro_modal').style.display = 'block';
  if(parseInt(year) === 1861 || parseInt(year) === 1864){
    document.getElementById('elections').style.display = 'block';
  }else{
    document.getElementById('elections').style.display = 'none';
  }
  setUpPoints(year);
  mouse_list_world = [];
  plotWorldData(parseInt(year));
  applySettings();
  //document.getElementById('search_box').style.display = 'block';
}

let battles_in_year = {};
//get points relevant to selected year
function setUpPoints(id){
  year = parseInt(id);
  let cm_keys = Object.keys(current_markers);
  for(let i = 0; i < cm_keys.length; i++){
    current_markers[cm_keys[i]]['marker'].remove();
  }
  current_markers = {};
  let keys = Object.keys(civil_war_battles_geo);
  for(var battle_name in civil_war_battles){
    let battle = civil_war_battles[battle_name];
    let date = battle['date'].split(',');
    if(year === parseInt(date[1]) && keys.indexOf(battle_name) > -1){ 
      let battle_loc = civil_war_battles_geo[battle_name]['lat_lng'];
      let battle_lat = parseFloat(battle_loc.split(",")[0]);
      let battle_lng = parseFloat(battle_loc.split(",")[1]);
      let el = document.createElement('div');
      el.id = battle_name;
      let battle = civil_war_battles[battle_name];
      battles_in_year[battle_name] = battle;
      if(battle['class'] === 'A')
        el.style.backgroundImage = 'url(\'images/a_battle.png\')'; 
      if(battle['class'] === 'B')
        el.style.backgroundImage = 'url(\'images/b_battle.png\')'; 
      if(battle['class'] === 'C')
        el.style.backgroundImage = 'url(\'images/c_battle.png\')'; 
      if(battle['class'] === 'D')
        el.style.backgroundImage = 'url(\'images/d_battle.png\')';
      el.style.borderRadius = 6 + 'px';
      el.style.width = 30 + 'px';
      el.style.height = 30 + 'px';
      let marker = new mapboxgl.Marker(el)
        .setLngLat([battle_lng, battle_lat])
        .addTo(map);
      el.addEventListener('click', setMarkerName, false);
      current_markers[battle_name] = {'marker': marker, 'lat': battle_lat, 'lon': battle_lng};
    }
  }
}

function checkBattle(inp) {
  let input = document.getElementById(inp);
  let arr = Object.keys(current_markers);
}
    </script>
  </body>
</html>