<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <title>Profile</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="328858787046-95fsdbnk5kil4druiacprsubihssktju.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <style>
    body,h1,h2,h3,h4,h5,h6 {font-family: "Raleway", Arial, Helvetica, sans-serif}
    .myLink {display: none}
    </style>
  </head>
  <body class="w3-light-grey">
    <!-- Navigation Bar -->
    <div id="gsignin2" class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
    <div class="mainDiv" style="text-align: center; display: block; margin: 0 auto;">
      <div id="userContent" class="w3-row-padding w3-padding-64 w3-container">
        <div class="w3-content">
          <div class="w3-twothird">
            <h1 id="username"></h1>
            <p id="joinDate"></p>
            <img id="pic" src="#">
            <p id="yourSearches" class="w3-text-grey"></p>
            <p id="placeRecs" class="w3-text-grey"></p>
            <p id="commentHistory" class="w3-text-grey"></p>
          </div>
        </div>
      </div>
      <p></p>
      <div id="signout" class="btn white darken-4 col s10 m4">
           <button class="w3-button w3-dark-grey" onclick="signOut();">
               <div class="left">
                   <img width="20px" alt="Google &quot;G&quot; Logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png"/>
                   Sign out
               </div>
           </button>
      </div>
    </div>
    <script>
      /*var config = {
          apiKey: "AIzaSyAJD37p9xcHp22p5cnpp3YxHLDQnAuHtKw",
          authDomain: "emovo-1a6a7.firebaseapp.com",
          databaseURL: "https://emovo-1a6a7.firebaseio.com/",
          storageBucket: "emovo-1a6a7.appspot.com"
        }
      firebase.initializeApp(config);*/
      //window.onload = function(){
      var isIn=isLoggedIn();
      console.log(isIn)
      var account={};
      if(isIn==false){
        //console.log(document.getElementById('gsignin2'))
        document.getElementById('gsignin2').style.display = "block";
        document.getElementById("userContent").style.display = "none";
        document.getElementById("signout").style.display = "none";
      }/*else{
        account = JSON.parse(sessionStorage.getItem('currUser'));
        console.log(account)
        document.getElementById('gsignin2').style.display = "none";
        document.getElementById("userContent").style.display = "block";
        document.getElementById("signout").style.display = "block";
        document.getElementById("username").innerHTML="Hi "+currUser["name"]+"!";
        document.getElementById("pic").src=currUser["picture"];
      }*/
      function onSignIn() {
        // Useful data for your client-side scripts:
        const googleUser = gapi.auth2.getAuthInstance().currentUser.get();
        const profile = googleUser.getBasicProfile();
        //var profile = googleUser.getBasicProfile();
        console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        console.log('Full Name: ' + profile.getName());
        console.log('Given Name: ' + profile.getGivenName());
        console.log('Family Name: ' + profile.getFamilyName());
        console.log("Image URL: " + profile.getImageUrl());
        console.log("Email: " + profile.getEmail());
        // The ID token you need to pass to your backend:
        document.getElementById('gsignin2').style.display = "none";
        document.getElementById("userContent").style.display = "block";
        document.getElementById("signout").style.display = "block";
        var id_token = googleUser.getAuthResponse().id_token;
        console.log("ID Token: " + id_token);
        document.getElementById("username").innerHTML="Hi "+profile.getGivenName()+"!";
        document.getElementById("pic").src=profile.getImageUrl();
        //firebase retrieval here
        /*
        document.getElementById("joinDate").innerHTML
        <p id="yourSearches" class="w3-text-grey"></p>
        <p id="placeRecs" class="w3-text-grey"></p>
        <p id="commentHistory" class="w3-text-grey"></p>
        var currentdate = new Date();
        var datetime = "Last Sync: " + currentdate.getDate() + "/"
                        + (currentdate.getMonth()+1)  + "/"
                        + currentdate.getFullYear() + " @ "
                        + currentdate.getHours() + ":"
                        + currentdate.getMinutes() + ":"
                        + currentdate.getSeconds();
        */
        var currUser = {};
        currUser["id"] = profile.getId();
        currUser["name"] = profile.getGivenName(); //first name only
        currUser["picture"] = profile.getImageUrl();
        sessionStorage.setItem('currUser',JSON.stringify(currUser));
      }
      function isLoggedIn()
      {
        if(sessionStorage.getItem('currUser') == null){
          return false;
        } else {
          return true;
        }
      }
      function signOut() {
        sessionStorage.clear();
        /*var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
          document.getElementById('gsignin2').style.display = "block";
          document.getElementById("userContent").style.display = "none";
          document.getElementById("signout").style.display = "none";
        });*/
        alert("Signing out...")
        document.getElementById('gsignin2').style.display = "block";
        document.getElementById("userContent").style.display = "none";
        document.getElementById("signout").style.display = "none";
        location.href="https://www.google.com/accounts/Logout?continue=https://appengine.google.com/_ah/logout?continue=https://emovo.github.io/"
      }
    //}
    </script>
  </body>
</html>
