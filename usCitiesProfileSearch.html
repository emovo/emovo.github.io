<!DOCTYPE html>
<html lang="en" dir="ltr">
    <title>EMOVO</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="emovo.png">
<body class="w3-light-grey">
     <div>
       <div class="w3-bar w3-light-grey w3-card w3-left-align w3-large">
         <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-orange" href="javascript:void(0);" onclick="toggle()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
         <a href="index.html" class="w3-bar-item w3-button w3-text-orange w3-hide-small w3-padding-large w3-hover-orange"><b><img src="emovo.png" width="25px" height="25px" alt="EMOVO"></img></b></a>
         <a href="about.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-orange">About</a>
         <a href="contact.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-orange">Contact</a>
         <a href="search.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-orange">World Search</a>
         <a href="housing.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-orange">US Housing</a>
         <!--<a href="profile.html" class="w3-bar-item w3-button w3-right w3-hide-small w3-padding-large w3-hover-orange w3-text-grey"><i class="fa fa-user"></i>  Your Profile</b></a>-->
       </div>

       <!-- Navbar on small screens -->
       <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
         <a href="index.html" class="w3-bar-item w3-button w3-padding-large">EMOVO</a>
         <a href="about.html" class="w3-bar-item w3-button w3-padding-large">About</a>
         <a href="contact.html" class="w3-bar-item w3-button w3-padding-large">Contact</a>
         <a href="search.html" class="w3-bar-item w3-button w3-padding-large">World Search</a>
         <a href="housing.html" class="w3-bar-item w3-button w3-padding-large">US Housing</a>
         <!--<a href="profile.html" class="w3-bar-item w3-button w3-padding-large">Your Profile</a>-->
       </div>
      </div>
      <div class="w3-orange">
        <!--<img id="flaglink" src="#" width="200px">--><!--have it to the left with basic facts about area-->
        <h3 id="sname">City name</h3>
        <p id="avgStar"></p>
        <p id="summary">
          <!--Strong Points:
          <br>
          Average Qualities:
          <br>
          Weaker Points:
          <br>-->
          The data was compiled from numerous sources as explained <a href="about.html">here</a>. If you find any major errors, please send me an email through <a href="contact.html">here</a>.
          Post in the comments to provide a helpful view of this city to others! Conversely, be sure to look in the comments for more specific details from those who lived there.
        </p>
      </div>
      <br>
      <!--<div class="right-text">
        <h4>Notes</h4>

      </div>-->
      <div class="right-data">
        <div class="right-right-data">
        <table class="tableData" style="margin:auto;">
              <div class="econ">
                <h5 style="margin:0 auto;text-align:center; background-color:green; color:white;">Economic Data  <i class="fa fa-dollar"></i></h5>
                <!--<h6 id="econSortRank" style="text-align:center; color:green;">80th percentile (#5)</h6>-->
                    <tr>
                      <td>State Data</td>
                    </tr>
                    <tr>
                      <td>Avg Income</td>
                      <td id="avgIncome">$10000
                        <td id="avgIncomeDiff" style="color:green;">
                          <div class="tooltip">
                            <span id="avgIncomeDiffVal" style="border-bottom: 1px dotted #000;text-decoration: none;">$10000</span>
                            <span id="tooltiptextavgIncome" class="tooltiptext">Better than avg.</span>
                          </div>
                      </td>
                     </td>
                    </tr>
                    <tr>
                      <td>Median Property Cost: </td>
                      <td id="median">$10000</td>
                      <td id="medianDiff" style="color:green;">
                          <div class="tooltip">
                            <span id="medianDiffVal">$10000</span>
                            <span id="tooltiptextmedianDiff" class="tooltiptext">Better than avg.
                            </span>
                          </div>
                      </td>
                    </tr>
                    <tr>
                      <td>Healthcare Cost: </td>
                      <td id="healthCareCost"></td>
                    </tr>
                    <tr>
                      <td>Unemployment Rate: </td>
                      <td id="unemploymentRate"></td>
                    </tr>
                </div>
            </table>
            <br>
            <table style="margin:0 auto;">
              <div class="phealth">
                  <table class="tableData" style="margin:0 auto;">
                    <h5 style="margin:0 auto;text-align:center;background:red;color:white;">Personal Health Data <i class="fa fa-plus-square"></i></h5>
                    <!--<h6 id="healthSortRank" style="text-align:center; color:green;">80th percentile (#5)</h6>-->
                    <tr>
                      <td>State Data</td>
                    </tr>
                    <tr>
                      <td>People: 1 Doctor Ratio</td>
                      <td id="popPerDoctorRatio">200 people per doctor</td>
                    </tr>
                    <tr>
                      <td>People: 1 Dentist Ratio</td>
                      <td id="popPerDentistRatio">200 people per dentist</td>
                    </tr>
                    <tr>
                      <td>People: 1 Mental Health Provider Ratio</td>
                      <td id="popPerMentalHealthRatio">200 people per mental health providers</td>
                    </tr>
                    <tr>
                      <td>People: 1 Nursing or Physician Health Provider Ratio</td>
                      <td id="popOtherHealthRatio">200 people per nursing and physician health <br>providers</td>
                    </tr>
                    <tr>
                      <td>% of Eligible Medicare Enrollees Having an Annual Diabetic Screening</td>
                      <td id="diabeticScreening">23% of eligible Medicare enrollees got an annual <br>diabetic screening</td>
                    </tr>
                    <tr>
                      <td>% of Eligible Medicare Enrollees Having an Annual Mammogram Screening</td>
                      <td id="mammogramScreening">23% of eligible Medicare enrollees got an<br> annual mammogram screening</td>
                    </tr>
                  </table>
              </div>
            </table>
            <br>
            <br>
            <table style="margin:0 auto;">
              <div class="chealth">
                  <table class="tableData" style="margin:0 auto;">
                    <h5 style="margin:0 auto;text-align:center; background:gold;width:56.5%;">Community Health Data <i class="fa fa-hospital-o"></i></h5>
                    <!--<h6 id="comHealthSortRank" style="text-align:center; color:green;">80th percentile (#5)</h6>-->
                    <tr>
                      <td>State Data</td>
                    </tr>
                    <tr>
                      <td>% of State Residents Near a Park or Recreational Center</td>
                      <td id="exerciseAccess">200 people per doctor</td>
                    </tr>
                    <tr>
                      <td>People: 1 Social Association Ratio</td>
                      <td id="socialGroup">200 people per dentist</td>
                    </tr>
                    <tr>
                      <td>Violent Crime Percentage Rate</td>
                      <td id="violentCrime">200 people per mental health providers</td>
                    </tr>
                    <tr>
                      <td>People: 1 Nursing or Physician Health Provider</td>
                      <td id="popHealth">200 people per <br>nursing and physician health providers</td>
                    </tr>
                    <tr>
                      <td>% of Residents with Limited Food Access</td>
                      <td id="foodInsecurity">23% of eligible Medicare enrollees got an<br> annual diabetic screening</td>
                    </tr>
                    <tr>
                      <td>% of Residents who're Low Income and aren't Near Food Sources (i.e. grocery stores)</td>
                      <td id="limitedFoodAccess">23% of eligible Medicare enrollees got an<br> annual mammogram screening</td>
                    </tr>
                  </table>
              </div>
            </table>
            <br>
            <table style="margin:0 auto;">
              <div class="env">
                  <table class="tableData" style="margin:0 auto;">
                    <h5 style="margin:0 auto;text-align:center;background:#00FF00;width:56.5%">Environment Data <i class="fa fa-industry"></i></h5>
                    <!--<h6 id="comHealthSortRank" style="color:green;text-align:center;">80th percentile (#5)</h6>-->
                    <tr style="text-align:center;">
                      <td>State Data</td>
                    </tr>
                    <tr>
                      <td>Pollution (ppm-parts per million)</td>
                      <td id="pollution" style="text-align:left;">200 people per doctor</td>
                    </tr>
                    <tr>
                      <td>Food Health Index (1-worst, 10-best)</td>
                      <td id="foodHealthIndex" style="text-align:left;">200 people per dentist</td>
                    </tr>
                    <tr>
                      <td>% of Residents who're Under Poor Quality Water System: </td>
                      <td id="waterViolations" style="text-align:left;">200 people per mental health providers</td>
                    </tr>
                    <tr>
                      <td>% of Residents Living in Poor Quality Housing: </td>
                      <td id="housingIssues" style="text-align:left;">200 people per <br>nursing and physician health providers</td>
                    </tr>
                    <tr>
                      <td>Mean Work Commute Time (minutes): </td>
                      <td id="meanCommute" style="text-align:left;">23% of eligible Medicare enrollees got an<br> annual diabetic screening</td>
                    </tr>
                  </table>
              </div>
            </table>
      </div>
      <br>
      <!--<div style="display: table; margin: auto;">
        <p>Featured Location Video</p>
        <iframe id="video" width="400" height="300" src="#">
        </iframe>
      </div>-->
     <br>
     <p id="login" style="display:table; margin: 0 auto;">You must be logged in to rate and comment</p>
     <br>
     <div class="userReply">
       <p style="margin: auto;">How would you rate the place in terms of livability, especially in regards to retirees (1-5 stars)? Explain in the comment box below if you wish to futher elaborate to inform other users.</p>
       <p></p>
           <form id="starsRating" style="display: inline-block;">
             <input class="star star-5" id="star-5" type="radio" name="star" value="5"/>
             <label class="star star-5" for="star-5"></label>
             <input class="star star-4" id="star-4" type="radio" name="star" value="4"/>
             <label class="star star-4" for="star-4"></label>
             <input class="star star-3" id="star-3" type="radio" name="star" value="3"/>
             <label class="star star-3" for="star-3"></label>
             <input class="star star-2" id="star-2" type="radio" name="star" value="2"/>
             <label class="star star-2" for="star-2"></label>
             <input class="star star-1" id="star-1" type="radio" name="star" value="1"/>
             <label class="star star-1" for="star-1"></label>
           </form>
           <div class="container">
             <div class="left-pic">
               <img id="profileImg" src="https://cdn2.iconfinder.com/data/icons/website-icons/512/User_Avatar-512.png" width="70px" height="70px" style="border-radius: 50%;">
             </div>
            <div class="right">
                  <textarea id="yourComment" name="name" rows="4" cols="40" placeholder="Enter comment here"></textarea>
             </div>
           </div>
           <p></p>
           <div>
             <button class="w3-button w3-orange" type="submit" onclick="sendMessage()">Send rating and/or review</button>
           </div>
     </div>
    </div>
    <div id="justSents">
    </div>
    <div style="margin-left:-8px;margin-right:-8px"><hr style="color:Black;background-color:Black;border:0;width:100%;height:1px;" /></div>
    <div id="commentSpace">
      <!--<div>
        <input type="text" id="input" onkeyup="filter()" placeholder="Search" title="Type keywords">
      </div>-->
      <!--<div>
        <select id="commentFilter" onchange="filter()">
          <option value="Newest" selected="selected">Newest</option>
          <option value="likes">Likes</option>
          <option value="commenter">Commenter</option>
          <option value="replies">Replies to you</option>
        </select>
      </div>-->
     </div>
   </div>
   <div id="updownSort">

   </div>
</body>
<style>

body, html {
	height: 100%;
	width: 100%;
}
.tooltip {
  position: relative;
  display: inline-block;
  top: 100%;
}
.tooltip .tooltiptext{
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip
    z-index: 1;
    bottom: 100%;
    left: 10%;*/
}
.tooltip:hover .tooltiptext {
  visibility: visible;
}
.left-data{
  display: inline-block;
  background-color:orange;
  color:white;
  position: absolute;
  height:150%;
  width:15%;
  /*top: 0;*/
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.right-right-data{
  display: inline-block;
}
.right-data{
  width: 100%;
  text-align: center;
  /*display:table;
  margin: 0 auto;
  vertical-align: middle;*/
  /*position: absolute;
  text-align: center;
  right: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;*/
}
.right-text{
  display: inline-block;
  background-color:orange;
  color:white;
  position: absolute;
  height:100%;
  width:15%;
  right: 0;
  text-align: center;
  overflow: hidden;
}
.fourTable, td {
border: 1px solid black;
}
/*.top-boxes{
  display:table;
  margin: 0 auto;
}
.econ{
  width:10%;
  border: 15px solid green;
}
.phealth{
  width:10%;
  border: 15px solid green;
}

.bottom-boxes{
  display:table;
  margin: 0 auto;
}
.chealth{
  width:10%;
  border: 15px solid green;
}
.env{
  width:10%;
  border: 15px solid green;
}*/
.loadMore{
  display: table;
  margin: 0 auto;
}
.userReply{
  width: 36%;
  display: table;
  margin: 0 auto;
  text-align: center;
}
.container{
  width:500px;
  min-height:65px;
}
.left-pic{
  float: left;
  width:50px;
}
.right{
  float: right;
  width:400px;
}
.comment-body {
  display: inline-block;
  vertical-align: middle;
  width: 400px;
  min-height: 65px;
  color: #555;
  background-color: white;
}
input.star { display: none; }
label.star {
	  float: right;
    margin:0 auto;
	  padding: 10px;
	  font-size: 36px;
	  color: #444;
	  transition: all .2s;
	}
input.star:checked ~ label.star:before {
	  content: '\f005';
	  color: #FD4;
	  transition: all .25s;
	}
	input.star-5:checked ~ label.star:before {
	  color: #FE7;
	  text-shadow: 0 0 20px #952;
	}
	input.star-1:checked ~ label.star:before { color: #F62; }
	label.star:before {
	  content: '\f006';
	  font-family: FontAwesome;
	}
  .tableData {
  border-collapse: collapse;
  width: 75%;
}

.tableData td, .tableData th {
  border: 1px solid #ddd;
  padding: 8px;
}

.tableData tr:nth-child(even){background-color: #f2f2f2;}

.tableData tr:hover {background-color: #ddd;}

.tableData th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #4CAF50;
  color: white;
}
</style>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
<script type="text/javascript">
function toggle() {
  var x = document.getElementById("navDemo");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
  } else {
    x.className = x.className.replace(" w3-show", "");
  }
}
var stateCapitals={
  'Alabama': 'Montgomery',
  'Alaska': 'Juneau',
  'Arizona':'Phoenix',
  'Arkansas':'Little Rock',
  'California': 'Sacramento',
  'Colorado':'Denver',
  'Connecticut':'Hartford',
  'Delaware':'Dover',
  'Florida': 'Tallahassee',
  'Georgia': 'Atlanta',
  'Hawaii': 'Honolulu',
  'Idaho': 'Boise',
  'Illinois': 'Springfield',
  'Indiana': 'Indianapolis',
  'Iowa': 'Des Monies',
  'Kansas': 'Topeka',
  'Kentucky': 'Frankfort',
  'Louisiana': 'Baton Rouge',
  'Maine': 'Augusta',
  'Maryland': 'Annapolis',
  'Massachusetts': 'Boston',
  'Michigan': 'Lansing',
  'Minnesota': 'St. Paul',
  'Mississippi': 'Jackson',
  'Missouri': 'Jefferson City',
  'Montana': 'Helena',
  'Nebraska': 'Lincoln',
  'Nevada': 'Carson City',
  'New Hampshire': 'Concord',
  'New Jersey': 'Trenton',
  'New Mexico': 'Santa Fe',
  'New York': 'Albany',
  'North Carolina': 'Raleigh',
  'North Dakota': 'Bismarck',
  'Ohio': 'Columbus',
  'Oklahoma': 'Oklahoma City',
  'Oregon': 'Salem',
  'Pennsylvania': 'Harrisburg',
  'Rhode Island': 'Providence',
  'South Carolina': 'Columbia',
  'South Dakota': 'Pierre',
  'Tennessee': 'Nashville',
  'Texas': 'Austin',
  'Utah': 'Salt Lake City',
  'Vermont': 'Montpelier',
  'Virginia': 'Richmond',
  'Washington': 'Olympia',
  'West Virginia': 'Charleston',
  'Wisconsin': 'Madison',
  'Wyoming': 'Cheyenne'
}
//document.getElementById("myModal").style="display:none;"
//console.log(localStorage.getItem("USCityFoundSearch"))
//console.log(localStorage.getItem("stateSearch"))
var city=JSON.parse(localStorage.getItem("USCityFoundSearch"))
var stateName=localStorage.getItem("stateSearch")

document.getElementById("video").src="https://www.youtube.com/embed/?listType=search&list="+city.name.replace(" "+"-")+"-"+stateName.replace(" "+"-")+"&autoplay=1"
//document.getElementById("video").src="https://www.youtube.com/embed/?listType=search&list=living-in-"+stateName.replace(" "+"-")+"&autoplay=1"
//console.log(state)
document.getElementById("starsRating").reset()

//document.getElementById("flaglink").style.display="none"

document.getElementById("sname").innerHTML=city.name

document.getElementById("avgIncome").innerHTML="$"+city.avgIncome.toFixed(2)
document.getElementById("avgIncomeDiffVal").style.display="none"
document.getElementById("avgIncomeDiff").style.display="none"
document.getElementById("tooltiptextavgIncome").style.display="none"
/*document.getElementById("avgIncomeDiffVal").innerHTML="$"+(localStorage.monthlyIncomeUS*12.0).toFixed(2)
var avgIncomeDiffStyle="border: none; color:green;"
document.getElementById("avgIncomeDiff").style=avgIncomeDiffStyle
var text=""
var fract=city.avgIncome/(localStorage.monthlyIncomeUS*12.0)
//console.log(fract+"")
if(fract<.25){
  text="Looking at income alone, your economic status is very above average"
  avgIncomeDiffStyle="border: none; color:green;"
}
else if(fract>=1.75){
  text="Looking at income alone, your economic status is very below average"
  avgIncomeDiffStyle="border: none; color:red;"
}
else if(fract>.75 && fract<1.25){
  text="Looking at income alone, your economic status is around average"
  avgIncomeDiffStyle="border: none; color:orange;"
}
else if(fract<=.75){
  text="Looking at income alone, your economic status is above average"
  avgIncomeDiffStyle="border: none; color:green;"
}
else if(fract>=1.25){
  text="Looking at income alone, your economic status is below average"
  avgIncomeDiffStyle="border: none; color:red;"
}
document.getElementById("tooltiptextavgIncome").innerHTML=text*/
document.getElementById("median").innerHTML="$"+city.medianPropertyCost.toFixed(2)
/*if(city.medianDiff==null){
  city.medianDiff=parseFloat(localStorage.yourSavingsUS) + ((parseFloat(localStorage.monthlyIncomeUS*12.0))-city.avgIncome)-city.medianPropertyCost
  //console.log(city.medianDiff+"")
}
var medianDiffStyle="border: none;"
text="Based on your savings of $"+parseFloat(localStorage.yourSavingsUS).toFixed(2)+" and income"
if(city.medianDiff>=city.medianPropertyCost/6.0){
  text+=", housing is pretty affordable"
  medianDiffStyle="border: none; color:green;"
}
else if(city.medianDiff>=city.medianPropertyCost/12.0){
  text+=", housing is affordable"
  medianDiffStyle="border: none; color:green;"
}
else if(city.medianDiff>=0.0){
  text+=", housing is somewhat average"
  medianDiffStyle="border: none; color:orange;"
}
else if(city.medianDiff<=-city.medianPropertyCost/6.0){
  text+=", housing is not affordable"
  medianDiffStyle="border: none; color:red;"
}
else if(city.medianDiff<=-city.medianPropertyCost/12.0){
    text+=", housing is not very affordable"
    medianDiffStyle="border: none; color:red;"
}
document.getElementById("medianDiffVal").innerHTML=text//"$"+city.medianDiff.toFixed(2)
document.getElementById("medianDiff").style=medianDiffStyle*/
document.getElementById("medianDiffVal").style.display="none"
document.getElementById("medianDiff").style.display="none"
document.getElementById("tooltiptextmedianDiff").style.display="none"

document.getElementById("exerciseAccess").innerHTML=(city.exerciseAccess*100.0).toFixed(1)+"%"
document.getElementById("socialGroup").innerHTML=city.socialGroup.toFixed(3)+""
document.getElementById("violentCrime").innerHTML=(city.violentCrime).toFixed(3)+"/100,000 people"
document.getElementById("popHealth").innerHTML=city.popHealth.toFixed(3)+""
document.getElementById("foodInsecurity").innerHTML=(city.foodInsecurity*100.0).toFixed(2)+"%"
document.getElementById("limitedFoodAccess").innerHTML=(city.limitedFoodAccess*100.0).toFixed(2)+"%"

document.getElementById("pollution").innerHTML=city.pollution.toFixed(3)+" ppm"
document.getElementById("foodHealthIndex").innerHTML=city.foodHealthIndex.toFixed(3)+""
document.getElementById("waterViolations").innerHTML=(city.waterViolations*100.0).toFixed(2)+"%"
document.getElementById("housingIssues").innerHTML=(city.housingIssues*100.0).toFixed(2)+"%"
document.getElementById("meanCommute").innerHTML=city.meanCommute.toFixed(1)+""

document.getElementById("healthCareCost").innerHTML="$"+city.healthCareCost.toFixed(2)
document.getElementById("popPerDoctorRatio").innerHTML=city.popPerDoctorRatio.toFixed(2)+""
document.getElementById("popPerDentistRatio").innerHTML=city.popPerDentistRatio.toFixed(2)+""
document.getElementById("popPerMentalHealthRatio").innerHTML=city.popPerMentalHealthRatio.toFixed(2)+""
document.getElementById("popOtherHealthRatio").innerHTML=city.popOtherHealthRatio.toFixed(2)+""
document.getElementById("diabeticScreening").innerHTML=(city.diabeticScreening*100.0).toFixed(2)+"%"
document.getElementById("mammogramScreening").innerHTML=(city.mammogramScreening*100.0).toFixed(2)+"%"
document.getElementById("unemploymentRate").innerHTML=(city.unemploymentRate*100.0).toFixed(2)+"%"

var config = {
    apiKey: "AIzaSyAeVY1LvG9hNSBYb9_raGpYYDiHIvG3cY8",
    authDomain: "emovousers.firebaseapp.com",
    databaseURL: "https://emovousers.firebaseio.com/",
    storageBucket: "emovousers.appspot.com"
  }
firebase.initializeApp(config);
document.getElementById("profileImg").src="https://cdn2.iconfinder.com/data/icons/website-icons/512/User_Avatar-512.png"//currUser.picture
function Comment(t,d,p,li,di,id,na,sv,ud){
  this.text=t
  this.date=d
  this.place=p
  this.likes=li
  this.dislikes=di
  this.profileID=id
  this.profileName=na
  //this.profilePic=pi
  this.starVal=sv
  this.updownDiff=ud
}
function sendMessage(){
  var d=new Date();
  var starval=-1
  var ptext=document.getElementById("yourComment").value
  try{
    starval=parseInt($("input[name='star']:checked").val())
    //console.log(starval)
    if(isNaN(starval)){
      starval=-1.0
    }
  }catch(err){
    starval=-1.0
  }
  var text=ptext
  //var profile = auth2.currentUser.get().getBasicProfile();
  var array = new Uint32Array(1);
  window.crypto.getRandomValues(array);
  var uid=array[0]
  var profileID="user-"+uid
  var aComment=new Comment(text,d.getTime(),city,0,0,uid,profileID,starval,0)
  firebase.database().ref().child("USCities").child(city.name).child("comments").child(uid).set({
    "text":aComment.text,
    "date":aComment.date,
    "place":aComment.place,
    "likes":aComment.likes,
    "dislikes":aComment.dislikes,
    "profileID":aComment.profileID,
    "profileName":aComment.profileName,
    "starVal":aComment.starVal,
    "updownDiff":aComment.updownDiff
  })
  //display comment
  document.getElementById("login").innerHTML="Comment '"+text.slice(0,10)+"...' was added"
    var overall=document.getElementById("justSents")
    //overall.appendChild(document.createElement("br"))
    var urdiv = document.createElement("div")
    urdiv.className="userReply"
    var leftpicDiv=document.createElement("div")
    leftpicDiv.className="left-pic"
    var profileImg=document.createElement("img")
    profileImg.src="https://cdn2.iconfinder.com/data/icons/website-icons/512/User_Avatar-512.png"
    profileImg.style="border-radius:50%;width:70px;height:70px;"
    leftpicDiv.appendChild(profileImg)
    urdiv.appendChild(leftpicDiv)
    var rightDiv=document.createElement("div")
    rightDiv.className="right"
    var commentDiv=document.createElement("div")
    commentDiv.className="comment-body"
    commentDiv.appendChild(document.createTextNode(aComment.text))
    rightDiv.appendChild(commentDiv)
    var bottomDiv=document.createElement("div")
    var bytext="By "
    if(isNaN(aComment.starVal)){}
    else{
     if(aComment.starVal!=null){
      if(aComment.starVal!=-1.0){
        bytext="(Rated "+aComment.starVal+" stars), By "
      }
     }
    }
    //console.log(bytext)
    bottomDiv.appendChild(document.createTextNode(bytext))
    //var n = document.createElement('a');
    var lt = document.createTextNode(profileID);
    //n.appendChild(lt)
    //n.href = "profile.html";
    bottomDiv.appendChild(lt)
    var date = new Date(aComment.date);
    var day = date.getDate();
    var months = ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    var month = date.getMonth()//months[date.getMonth()];
    var year = date.getFullYear().toString().substr(-2);
    var stDate = (month+1)+"/"+day+"/"+year
    bottomDiv.appendChild(document.createTextNode(", "+stDate+", "))
    var score=document.createElement("span")
    score.id="score"
    score.innerHTML=(aComment.likes-aComment.dislikes)+""
    if(aComment.likes-aComment.dislikes==0)
      score.style="color:grey;"
    else if(aComment.likes-aComment.dislikes>0)
      score.style="color:green;"
    else if(aComment.likes-aComment.dislikes<0)
      score.style="color:red;"
    //console.log("complete")
    bottomDiv.appendChild(score)
    rightDiv.appendChild(bottomDiv)
    urdiv.appendChild(rightDiv)
    overall.appendChild(urdiv)
}
var getData=null
var deleteclicks={}
var editclicks={}
var updownvotes={}
window.onload=getFirebaseComments;
function getFirebaseComments(){
  var totalStars=0.0
  var starRatingCount=0.0
  var ref=firebase.database().ref().child("USCities").child(city.name).child("comments")
  ref.on("value", function(snapshot, prevChildKey) {//set it to profile
    var snapshotData = snapshot.val();
    //console.log(snapshotData)
    if(snapshotData!=null){
      getData=snapshotData
      var commentCount=0
      for(var i in snapshotData){
        var overall=document.getElementById("commentSpace")
        if(i<=9){
          overall.appendChild(document.createElement("br"))
        }
        if(snapshotData[i].starVal!=-1.0){
          totalStars+=parseFloat(snapshotData[i].starVal)
          starRatingCount+=1.0
        }
        updownvotes[i]=0
        var urdiv = document.createElement("div")
        urdiv.id=i+"-comment"
        urdiv.className="userReply"
        var leftpicDiv=document.createElement("div")
        leftpicDiv.className="left-pic"
        var profileImg=document.createElement("img")
        profileImg.id=snapshotData[i].profileID+"-"+i
        profileImg.src="https://cdn2.iconfinder.com/data/icons/website-icons/512/User_Avatar-512.png"
        profileImg.style="border-radius: 50%;width:50px;height:50px;"
        leftpicDiv.appendChild(profileImg)
        urdiv.appendChild(leftpicDiv)
        var rightDiv=document.createElement("div")
        rightDiv.className="right"
        var commentDiv=document.createElement("div")
        commentDiv.id=snapshotData[i].profileID+"-commentDiv"
        commentDiv.className="comment-body"
        commentDiv.appendChild(document.createTextNode(snapshotData[i].text))
        rightDiv.appendChild(commentDiv)
        var bottomDiv=document.createElement("div")
        var bytext="By "
        if(isNaN(snapshotData[i].starVal)){}
        else{
         if(snapshotData[i].starVal!=null){
          if(snapshotData[i].starVal!=-1.0){
            bytext="("+snapshotData[i].starVal+" stars), By "
          }
         }
        }
        //console.log(bytext)
        bottomDiv.appendChild(document.createTextNode(bytext))
        var lt = document.createTextNode(snapshotData[i].profileName);
        bottomDiv.appendChild(lt)
        var date = new Date(snapshotData[i].date);
        var day = date.getDate();
        var months = ["January", "February", "March", "April", "May", "June",
          "July", "August", "September", "October", "November", "December"
        ];
        var month = date.getMonth()//months[date.getMonth()];
        var year = date.getFullYear().toString().substr(-2);
        var stDate = (month+1)+"/"+day+"/"+year
        var datediv=document.createTextNode(", "+stDate+", ")
        datediv.id=i+"-dateDiv"
        bottomDiv.appendChild(datediv) //bottomDiv
        var score=document.createElement("span")
        score.id=i+"-score"
        score.innerHTML=(snapshotData[i].likes-snapshotData[i].dislikes)+""
        if(snapshotData[i].likes-snapshotData[i].dislikes==0)
          score.style="color:grey;"
        else if(snapshotData[i].likes-snapshotData[i].dislikes>0)
          score.style="color:green;"
        else if(snapshotData[i].likes-snapshotData[i].dislikes<0)
          score.style="color:red;"
        bottomDiv.appendChild(score)
        bottomDiv.appendChild(document.createTextNode(", "))
        //check if if(currUser["jd"]) exists
        var reply=document.createElement("button")
        reply.id=i+"-reply"
        var ricon=document.createElement("i")
        ricon.className="fa fa-reply"
        reply.appendChild(ricon)
        reply.style="w3-button"
        reply.onclick=function(){
          var rid=this.id.split("-")
          //console.log(getData[rid[0]])
          if(getData[rid[0]].text.length<=50)
            document.getElementById("yourComment").value="Reply to "+getData[parseInt(rid[0])].profileName+"'s comment '"+getData[parseInt(rid[0])].text+"':"
          else
            document.getElementById("yourComment").value="Reply to "+getData[parseInt(rid[0])].profileName+"'s comment '"+getData[parseInt(rid[0])].text.slice(0,50)+"...':"
        }
        var upvote=document.createElement("button")
        upvote.id=i+"-upvote"
        var uicon=document.createElement("i")
        uicon.className="fa fa-thumbs-up"
        upvote.appendChild(uicon)
        upvote.onclick=function(){
          var pid=this.id.split("-")
          updownvotes[parseInt(pid[0])]=1
          getData[parseInt(pid[0])].likes+=1
          var diff=getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes
          if(diff>=2){
            this.style.background="#CDCDCD"
            getData[parseInt(pid[0])].likes-=diff
          }else if(diff==1){
            this.style.background="#99badd"
          }else if(diff==0){
            this.style.background="#99badd"
            getData[parseInt(pid[0])].likes+=1
            document.getElementById(pid[0]+"-downvote").style.background="#CDCDCD"
          }
          var gscore=pid[0]+"-score"
          getData[parseInt(pid[0])].updownDiff=(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes)
          document.getElementById(gscore).innerHTML="liked"//(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes)+""
          document.getElementById(gscore).style="color:green;"
          /*if(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes==0)
            document.getElementById(gscore).style="color:grey;"
          else if(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes>0)
            document.getElementById(gscore).style="color:green;"
          else if(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes<0)
            document.getElementById(gscore).style="color:red;"*/
          leave()
        }
        bottomDiv.appendChild(upvote)
        var downvote=document.createElement("button")
        downvote.id=i+"-downvote"
        var dicon=document.createElement("i")
        dicon.className="fa fa-thumbs-down"
        downvote.appendChild(dicon)
        downvote.style="w3-button"
        downvote.onclick=function(){
          var pid=this.id.split("-")
          updownvotes[parseInt(pid[0])]=-1
          getData[parseInt(pid[0])].dislikes+=1
          var diff=getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes
          if(diff<=-2){
            this.style.background="#CDCDCD"
            getData[parseInt(pid[0])].dislikes+=diff
          }else if(diff==-1){
            this.style.background="#ED4337"
          }else if(diff==0){
            this.style.background="#ED4337"
            getData[parseInt(pid[0])].dislikes+=1
            document.getElementById(pid[0]+"-upvote").style.background="#CDCDCD"
          }
          var gscore=pid[0]+"-score"
          getData[parseInt(pid[0])].updownDiff=(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes)
          document.getElementById(gscore).innerHTML="downvoted"//(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes)+""
          document.getElementById(gscore).style="color:red;"
          /*if(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes==0)
            document.getElementById(gscore).style="color:grey;"
          else if(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes>0)
            document.getElementById(gscore).style="color:green;"
          else if(getData[parseInt(pid[0])].likes-getData[parseInt(pid[0])].dislikes<0)
            document.getElementById(gscore).style="color:red;"*/
          leave()
        }
        bottomDiv.appendChild(downvote)
        bottomDiv.appendChild(reply)
        rightDiv.appendChild(bottomDiv)
        urdiv.appendChild(rightDiv)
        if(commentCount>9){
          urdiv.style="display:none;"
        }
        commentCount++
        overall.appendChild(urdiv)
      }
    }
    if(starRatingCount==0){
      document.getElementById("avgStar").innerHTML=city.name+" has 0 reviews. Be the first!"
    }else{
      if(starRatingCount==1)
        document.getElementById("avgStar").innerHTML="Average location rating of "+(totalStars/starRatingCount).toFixed(3)+" stars with "+starRatingCount+" review."
      else
        document.getElementById("avgStar").innerHTML="Average location rating of "+(totalStars/starRatingCount).toFixed(3)+" stars with "+starRatingCount+" reviews."
    }
  })
}
function leave(){
  //check getData
  var ref=firebase.database().ref().child("USCities").child(city.name).child("comments")
  ref.on("value", function(snapshot, prevChildKey) {//set it to profile
    var snapshotData = snapshot.val();
    //console.log(snapshotData)
    if(snapshotData!=null){
      for(var i in snapshotData){
        comment=snapshotData[i]
        /*if(editclicks[i]%2==1){
          ref.child(i).set(null) //delete old comment
        }*/
        if(deleteclicks[i]%2==1){
          ref.child(i).set(null) //delete this comment
        }
        if(updownvotes[i]==1){
          comment.likes+=1
        }else if(updownvotes[i]==-1){
          comment.likes-=1
        }
        ref.child(i).set(comment)
      }
    }
  })
}
$(window).scroll(function() {
  if($(window).scrollTop() == $(document).height() - $(window).height()) {
    withModal=$("div:hidden").slice(0, 10).fadeIn()
  }
});
</script>
</html>
